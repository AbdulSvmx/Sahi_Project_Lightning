//Author - Shashikala Kamath

var $BVT_TC_002_SFW_with_standard_Wiz_steps = _testcase("$BVT_TC_002_SFW_with_standard_Wiz_steps",
		"Configure the SFW to include standard SFMs and launch the same in delivery");

$BVT_TC_002_SFW_with_standard_Wiz_steps.start();
_setSpeed(100);



//Pre - Condition 
$bo_act_login.login("https://test.salesforce.com", "lohithaadmin@swatpart2.com", "maxpl0re2");

 
 
var $wizardSelectObjectName = "Work Order";
var $wizardTitleName = $bo_act_common.generateRandomName("SFWTitle");
var $wizardIDName = $bo_act_common.generateRandomName("SFWId");
var $wizardTitleName1 = $bo_act_common.generateRandomName("Parts Order");
var $wizardIDName1 = $bo_act_common.generateRandomName("PartsOrderID");
var $wizardStep1Type = "SFM";
var $wizardStep1Name = "Create Quote from Work Order";
var $wizardStep2Type = "Output Document";
var $wizardStep2Name = "Manage Work Order Lines - Usage";
var $executionMode1 = "Interactive";
var $executionMode2 = "Background";
var $wizardStep3Name = "Create Usage Lines from Estimates";
var $wizardStep4Name = "Work Order Service Report";
var $wizardStep5Name = "Create New Shipment Order";
var $handOver1 = true;
var $handOver2 = false;
var $selectTemplateAtRunTime = false;
var $wizardSelectObjectName1 = "Parts Order";



var $caseNumber = $bo_act_Cases.createCase("New", "High", "Email");
var $accountName = $bo_act_accounts.createAccount();
var $contactName = $bo_act_contacts.createContact($accountName);
var $productName =$bo_act_products.createProduct();
/**
 * Add Price To Standard Price for above created Product
*/ 

 var $standardPriceValue = 120;
 $bo_act_products.addStandardPriceForProduct($productName, $standardPriceValue);

var $IBName = $bo_act_installedProduct.createInstalledProduct($productName,$accountName,$contactName);


$bo_act_navigation.navigateToSfmWizard();
$bo_act_SFW.createWizardGeneralInfo($wizardSelectObjectName, $wizardTitleName, $wizardIDName);
$bo_act_SFW.createSFMWizardStepwithHandOver($wizardStep1Type, $wizardStep1Name, $executionMode1, $handOver1);
$bo_act_SFW.createSFMWizardStepwithHandOver($wizardStep1Type, $wizardStep2Name, $executionMode1, $handOver1);
$bo_act_SFW.createSFMWizardStepwithHandOver($wizardStep1Type, $wizardStep3Name, $executionMode1, $handOver1);
$bo_act_SFW.createOutputDocumentWizardStepwithSelectTemplate($wizardStep2Type, $wizardStep4Name, $selectTemplateAtRunTime);
var $fieldActnType = "Others";
var $actnName = "Check Entitlement WO";
$bo_act_SFW.addCustomActionToWizard($fieldActnType, $actnName);
$bo_act_SFW.quickSaveSFWizard();
$bo_act_SFW.saveAndClose();


//$bo_act_SFW.createSFMWizard($wizardSelectObjectName, $wizardTitleName, $wizardIDName, $wizardStep1Type, $wizardStep1Name, $executionMode1, $wizardStep2Type, $wizardStep2Name, $executionMode2);
//$bo_act_SFW.createWizardGeneralInfo($wizardSelectObjectName, $wizardTitleName, $wizardIDName);
//$bo_act_SFW.createWizardStep($wizardStep1Type, $wizardStep1Name, $executionMode1);
//$bo_act_SFW.createWizardStep($wizardStep1Type, $wizardStep2Name, $executionMode1);
//$bo_act_SFW.createWizardStep($wizardStep1Type, $wizardStep3Name, $executionMode1);
//$bo_act_SFW.createWizardStep($wizardStep2Type, $wizardStep4Name, // $executionMode1);
//$swat_act_sfmSearch.launchSfmSearch($searchItem,$workOrderNo);

$bo_act_navigation.navigateToSfmWizard();
$bo_act_SFW.createWizardGeneralInfo($wizardSelectObjectName1, $wizardTitleName1, $wizardIDName1);
$bo_act_SFW.createSFMWizardStepwithHandOver($wizardStep1Type, $wizardStep5Name, $executionMode1, $handOver1);

//Launch in delivery
$workOrderNo = $swat_act_workOrders.createWorkOrder($caseNumber, $accountName, $contactName, $IBName, "Open", "High", "Field Service");
//$woName = 


//_wait(3000);
//$sfm_act_common.globalSearch($workOrderNo);
//_click(_link($workOrderNo));
//_selectDomain("/svmx/"); 
//_selectDomain("/visual.force.com/");
//_isVisible(_cell({title: ""+$wizardTitleName+""}));
//_assertVisible(_cell({title:""+$wizardTitleName+""}),"Pass");

  
  // Create SLA Terms
  
  
 var $slaName = $bo_act_slaTerms.createSlaTerms("Default");
 $bo_act_slaTerms.addInitialResponseToSLA($slaName,"WorkOrder","Field Service","Medium","Created Date","5","10","SLA");
 $bo_act_slaTerms.addOnsiteResponseToSLA($slaName,"WorkOrder","Field Service","Medium","Created Date","10","15","SLA");

 //validation of SLA creation
 _assertExists(_span($slaName));
 
 
 // Create Service Contract(With child lines) and Activate it
  
 var $pastYear = 2;  // Start Date for Service Contract
 var $futureYear = 2;  // End Date for Service Contract

 // Creation of Service Contracts
 var $serviceContractName = $bo_act_serviceMaintenanceContracts.createServiceMaintenanceContract($accountName, $slaName, $futureYear, $pastYear);

 //Activating Created Service Contract
 $bo_act_serviceMaintenanceContracts.activateServiceContract($serviceContractName);
//Add Covered Product to Service Contract 

 var $pastYear = 3;  			// Start Date 'TODAY's' Date - 3 YEARS
 var $futureYear = 3;			// End Date 'TODAY's' Date + 3 YEARS

 $bo_act_serviceMaintenanceContracts.AddCoveredProducToServiceContract($serviceContractName, $IBName, $slaName, $pastYear, $futureYear);
 
//Add Entitled Contact to Service Contract 

 $bo_act_serviceMaintenanceContracts.addEntitledContactsToServiceContract($serviceContractName, $contactName);

// Add Parts Pricing To Service Contract 
var $pricePerUnit = 150;
$bo_act_serviceMaintenanceContracts.addPartsPricingToServiceContract($serviceContractName, $productName, $pricePerUnit);


 
// Perform Interactive Entitlement on WO using Service Contract
 
 // Use $WONumber in place of "WO-00000068"
 $bo_act_interactiveEntitlement_WO.performInteractiveEntitlementWO_UsingScon($workOrderNo, $serviceContractName);
 var $actual_EntitlementType = _getText(_div(0,_rightOf(_cell("/Entitlement Type/"))));
 var $ServiceContract_actual = _getText(_link(0,_rightOf(_cell("Service Contract"))));
 _assertEqual($actual_EntitlementType,"INTERACTIVE","Actual and expected Entitlement Type are not same");
 _assertEqual($ServiceContract_actual,$serviceContractName,"Actual and expected Service Conract are not same");
 
_wait(3000);
$sfm_act_common.globalSearch($workOrderNo);

_click(_link($workOrderNo));


//_selectDomain("/visual.force.com/");
 _selectDomain("/svmx/"); 
 
// _isVisible(_cell({title: "SFWTitle31201814166"}));
// _assertVisible(_cell({title:"SFWTitle31201814166"}),"Pass");


_isVisible(_cell({title: $wizardTitleName}));
_assertVisible(_cell({title:$wizardTitleName}),"Pass");

//_click(_near(_cell({title: "SFWTitle31201814166"})_button("Create Quote from Work Order[1]")));
_click(_button("Create Quote from Work Order[1]"));
_selectDomain();


//_wait(9000);
//_label("Status:")
_wait(10000,_isVisible(_label("Status:")));

_setValue(_textbox("Status:"), "Presented");
_click(_div("sfm-button-1059"));

//Add a Parts Line
_click(_span("sfm-button-1103-btnIconEl"));
_click(_image("gif[5]"));

_click(_span("svmx-button-1208-btnIconEl"));
//_click(_span("sfm-button-1251-btnIconEl"));
_click(_span("svmx-btn-icon svmx-sfmd-search-icon "));

$bo_act_common.searchfunction($productName);
_setValue(_textbox("Qty:"), "2");
_setValue(_textbox("svmx-form-field svmx-form-required-field svmx-form-text svmx-form-invalid-field"), "4000");
_click(_span("Update"));

//Add a Labor Line
_click(_span("Labor"));
_click(_span("svmx-btn-icon svmx-sfmd-add-line-icon[1]"));
_click(_image("svmx-action-col-icon svmx-action-col-0   svmx-sfmd-edit-icon[1]"));
_setValue(_textbox("Qty:"), "3");
_setValue(_textbox("svmx-form-field svmx-form-required-field svmx-form-text svmx-form-invalid-field"), "6000");
_click(_span("Update"));

//Add a Expense Line
_click(_span("Expense"));
_click(_span("sfm-button-1172-btnIconEl"));
//_click(_span("svmx-btn-icon svmx-sfmd-add-line-icon[2]"));
//_click(_image("svmx-action-col-icon svmx-action-col-0   svmx-sfmd-edit-icon[1]"));
_click(_image("svmx-action-col-icon svmx-action-col-0   svmx-sfmd-edit-icon[2]"));
_setValue(_textbox("Qty:"), "4");
_setValue(_textbox("svmx-form-field svmx-form-required-field svmx-form-text svmx-form-invalid-field"), "8500");
_click(_span("Update"));
_click(_span("svmx-btn-icon svmx-sfmd-save-icon"));




//_click(_link("WO-00000088"));	
//_click(_link($workOrderNo));
// Invoke TDM016 Process
//_selectDomain("/visual.force.com/");
//_selectDomain("/svmx/"); 

//_isVisible(_cell({title: "SFWTitle1112018113658"}));

//_assertVisible(_cell({title:"SFWId1112018113658"}),"Pass");

//_click(_button("Manage Work Order Lines - Usage")); 

//_wait(3000,_isVisible( _label("Order Status:")));

//_selectDomain();

//Add Parts Line to Above invoked TDM016 SFM
//$productName = "pro161201812055";


// After saving 'Create Quote from Work Order' process, Handover takes place. Hence
// 'TDM016 - Manage Work Order Lines - Usage' process will be launched.


var $searchValue = $productName;
var $lineQty = "5";
var $pricePerUnit = 120;
$bo_act_getPrice.addPartsLineToSFMDelivery($searchValue,$lineQty);
$bo_act_getPrice.calculateGetPrice();

//Validation of Get Price for Parts lines

/*
$bo_act_getPrice.editPartsLineToSFMDelivery($searchValue);

var $PartsLinePricePerUnitActual = _getText(_textbox(0,_rightOf(_label("/Line Price Per Unit/"))));
var $PartsCoveredActual = _getText(_textbox(0,_rightOf(_label("/Covered %/"))));
var $PartsDiscountActual = _getText(_textbox(0,_rightOf(_label("/Discount %/"))));
var $PartsBillableQtyActual = _getText(_textbox(0,_rightOf(_label("/Billable Qty/"))));
var $PartsBillableLinePriceActual = _getText(_textbox(0,_rightOf(_label("/Billable Line Price/"))));

var $BillableLinePriceExpected = $lineQty*$pricePerUnit;

_assertEqual($PartsLinePricePerUnitActual,$pricePerUnit,"Actual and expected Parts Line Price Per Unit are not same");
_assertEqual($PartsBillableQtyActual,$lineQty,"Actual and expected Parts Billable Qty are not same");
_assertEqual($PartsBillableLinePriceActual,$BillableLinePriceExpected,"Actual and expected Parts Billable Line Price are not same");
_assertEqual($PartsCoveredActual,"0","Actual and expected Parts Covered % are not same");
_assertEqual($PartsDiscountActual,"0","Actual and expected Parts Discount % are not same");

$bo_act_getPrice.closeEditedWOLineToSFMDelivery();

$bo_act_getPrice.saveSFMDelivery();

/**
*Clean up function
*/

//var $datacreated = [$WONumber,$caseNumber,$IBName,$productName,$contactName,$accountName,$slaName,$serviceConractName];
//for (var i = 0; i < $datacreated.length; i++) {
//$bo_act_common.cleanUpfunction($datacreated[i]);
//}

//$bo_act_login.logOut();



//$bo_act_getPrice.closeEditedWOLineToSFMDelivery();

 $bo_act_getPrice.saveSFMDelivery();

//Add Parts Line to Above invoked TDM015 SFM
//Add a Parts Line

_click(_span("svmx-btn-icon svmx-sfmd-add-line-icon"));
_click(_image("svmx-action-col-icon svmx-action-col-0   svmx-sfmd-edit-icon"));


$bo_act_common.searchfunction($productName);
_setValue(_textbox("Line Qty:"), "5");
//_setValue(_textbox("svmx-form-field svmx-form-required-field svmx-form-text svmx-form-focus svmx-field-form-focus svmx-field-default-form-focus"), "5");
//_setValue(_textbox("svmx-form-field svmx-form-required-field svmx-form-text svmx-form-invalid-field"), "4000");
_click(_span("Update"));

//Add a Labor Line
$bo_act_getPrice.addLaborLineToSFMDelivery($searchValue, "service", "03", "05");


//Add a Expense Line
$bo_act_getPrice.addExpensesLineToSFMDelivery("Phone", "03", "3000");


//Add a Travel Line
$bo_act_getPrice.addTravelLineToSFMDeliveryUsingStartEndDate("01", "03");

_click(_span("svmx-btn-icon svmx-sfmd-save-icon"));

//Create Usage from Estimate 

$bo_act_getPrice.addPartsLineToSFMDelivery($searchValue,$lineQty);
//Add a Parts Line
_click(_span("svmx-btn-icon svmx-sfmd-add-line-icon"));
_click(_image("svmx-action-col-icon svmx-action-col-0   svmx-sfmd-edit-icon"));

$bo_act_common.searchfunction($productName);
_setValue(_textbox("Line Qty:"), "5");
//_setValue(_textbox("svmx-form-field svmx-form-required-field svmx-form-text svmx-form-focus svmx-field-form-focus svmx-field-default-form-focus"), "5");
//_setValue(_textbox("svmx-form-field svmx-form-required-field svmx-form-text svmx-form-invalid-field"), "4000");
_click(_span("Update"));

//Add a Labor Line
$bo_act_getPrice.addLaborLineToSFMDelivery($searchValue, "service", "03", "05");


//Add a Expense Line
$bo_act_getPrice.addExpensesLineToSFMDelivery("Phone", "03", "3000");


//Add a Travel Line
$bo_act_getPrice.addTravelLineToSFMDeliveryUsingStartEndDate("01", "03");

_click(_span("svmx-btn-icon svmx-sfmd-save-icon"));

_wait(30000, _isVisible(_button("Finalize")));
_click(_button("Finalize"));
_wait(30000, _isVisible(_link(0)));

$BVT_TC_002_SFW_with_standard_Wiz_steps.end();




