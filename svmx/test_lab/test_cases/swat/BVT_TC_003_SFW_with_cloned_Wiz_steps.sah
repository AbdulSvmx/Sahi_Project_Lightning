//*******************************//
//
//Author	:- 	Shashikala Kamath
//Pre-Req	:-	
//Steps		:-	
//
//*******************************//


var $BVT_TC_003_SFW_with_cloned_Wiz_steps = _testcase("BVT_TC_003_SFW_with_cloned_Wiz_steps",
		"Configure the SFW to include cloned/custom SFMs and launch the same in delivery");
$BVT_TC_003_SFW_with_cloned_Wiz_steps.start();
_setSpeed($g_stepSpeed);



//Pre - Condition 
$bo_act_login.login("https://test.salesforce.com", "shashikala.svmx@ge.com", "maxpl0re");

var $wizardObject = "Work Order";//remove later
var $wizardIDName = $bo_act_common.generateRandomName("Swat Smoke Test BVT_TC_003");//remove
var $wizardIDName1 = $bo_act_common.generateRandomName("Swat Smoke Test BVT_TC_003");//remove
var $caseNumber = $bo_act_Cases.createCase("New", "High", "Email");

var $accountName = $bo_act_accounts.createAccount();
var $contactName = $bo_act_contacts.createContact($accountName);
var $productName =$bo_act_products.createProduct();
var $standardPriceValue = 120;
$bo_act_products.addStandardPriceForProduct($productName, $standardPriceValue);

var $IBName = $bo_act_installedProduct.createInstalledProduct($productName,$accountName,$contactName);

/*
var $wizardObject = "Work Order";
//var $wizardName = "Swat Smoke Test BVT_TC_003";
var $isCustom = false;

var $wizardIDName = $bo_act_common.generateRandomName("Swat Smoke Test BVT_TC_003");
var $wizardIDName1 = $bo_act_common.generateRandomName("Swat Smoke Test BVT_TC_003");
var $wizardStep1Type = "SFM";
var $wizardStep2Type = "Output Document";
var $executionMode1 = "Interactive";
var $executionMode2 = "Background";
var $handOver1 = true;
var $handOver2 = false;
$selectTemplateAtRunTime = false; 


var $sfmToBeCloned1 = "Create Quote from Work Order";
var $sfmName1 = $bo_act_common.generateRandomName("Create_Quote_from_Work_Order");
var $sfmTemplateSaveAsName1 = $sfmName1;	
var $sfmTemplate1 = "SVMXSTD: Manage Quote Lines";   


var $sfmToBeCloned2 = "Manage Work Order Lines - Usage";
var $sfmName2 = $bo_act_common.generateRandomName("Manage_WO_Lines_Usage");
var $sfmTemplateSaveAsName2 = $sfmName2;
var $sfmTemplate2 = "SVMXSTD: Manage WO Usage Lines"; 

var $sfmToBeCloned3 ="Create Usage Lines from Estimates";
var $sfmName3 = $bo_act_common.generateRandomName("Create_Usage_Lines_from_Estimates");
var $sfmTemplateSaveAsName3 = $sfmName3;
var $sfmTemplate3 = "SVMXSTD: Create Usage from Estimates";    

var $sfmToBeCloned4 ="Work Order Service Report";
var $sfmName4 = $bo_act_common.generateRandomName("Work_Order_Service_Report");
var $sfmTemplateSaveAsName4 = $sfmName4;
var $sfmTemplate4 = "Work Order Service Report"; 

var $sfmToBeCloned5 ="Create New Shipment Order";
var $sfmName5 = $bo_act_common.generateRandomName("Create New Shipment Order");
var $sfmTemplateSaveAsName5 = $sfmName5;
var $sfmTemplate5 = "SVMXSTD: Create New Shipment Order";    



$sfm_act_SFM.cloneTDM016($sfmToBeCloned1, $sfmName1, $isCustom, $sfmTemplateSaveAsName1, $sfmTemplate1, "", "");
$sfm_act_SFM.cloneTDM016($sfmToBeCloned2, $sfmName2, $isCustom, $sfmTemplateSaveAsName2, $sfmTemplate2, "", "");
$sfm_act_SFM.cloneTDM016($sfmToBeCloned3, $sfmName3, $isCustom, $sfmTemplateSaveAsName3, $sfmTemplate3, "", "");
$sfm_act_SFM.cloneTDM016($sfmToBeCloned5, $sfmName5, $isCustom, $sfmTemplateSaveAsName5, $sfmTemplate5, "", "");
$swat_act_workOrderServiceReport.cloneWOServiceReport($sfmToBeCloned4, $sfmName4, $isCustom, $sfmTemplateSaveAsName4, $sfmTemplate4, "", "");

_click(_link("Home"));

//Create SFM Wizard and add the above created SFM process to the wizard steps

$bo_act_navigation.navigateToSfmWizard();
$bo_act_SFW.createWizardGeneralInfo($wizardObject, $wizardIDName, $wizardIDName1);
$bo_act_SFW.createSFMWizardStepwithHandOver($wizardStep1Type, $sfmTemplateSaveAsName1, $executionMode1, $handOver1);
$bo_act_SFW.createSFMWizardStepwithHandOver($wizardStep1Type, $sfmTemplateSaveAsName2, $executionMode1, $handOver1); 
$bo_act_SFW.createSFMWizardStepwithHandOver($wizardStep1Type, $sfmTemplateSaveAsName3, $executionMode1, $handOver1);
$bo_act_SFW.createOutputDocumentWizardStepwithSelectTemplate($wizardStep2Type, $sfmTemplateSaveAsName4, $selectTemplateAtRunTime); */
$bo_act_navigation.navigateToSfmWizard();
$bo_act_SFW.createWizardGeneralInfo($wizardObject, $wizardIDName, $wizardIDName1);
var $fieldActnType = "Others";
var $actnName = "Check Entitlement WO";
$bo_act_SFW.addCustomActionToWizard($fieldActnType, $actnName);
$bo_act_SFW.quickSaveSFWizard();
$bo_act_SFW.saveAndClose();


//Create SLA Terms
var $slaName = $bo_act_slaTerms.createSlaTerms("Default");
$bo_act_slaTerms.addInitialResponseToSLA($slaName,"WorkOrder","Field Service","Medium","Created Date","5","10","SLA");
$bo_act_slaTerms.addOnsiteResponseToSLA($slaName,"WorkOrder","Field Service","Medium","Created Date","10","15","SLA");

//validation of SLA creation
_assertExists(_span($slaName));

//Create Service Contract(With child lines) and Activate it
var $pastYear = 2;  // Start Date for Service Contract
var $futureYear = 2;  // End Date for Service Contract

// Creation of Service Contracts
var $serviceContractName = $bo_act_serviceMaintenanceContracts.createServiceMaintenanceContract($accountName, $slaName, $futureYear, $pastYear);

// Activating Created Service Contract
$bo_act_serviceMaintenanceContracts.activateServiceContract($serviceContractName);

//Add Covered Product to Service Contract 

var $pastYear = 3;  			// Start Date 'TODAY's' Date - 3 YEARS
var $futureYear = 3;			// End Date 'TODAY's' Date + 3 YEARS
$bo_act_serviceMaintenanceContracts.AddCoveredProducToServiceContract($serviceContractName, $IBName, $slaName, $pastYear, $futureYear);

//Add Entitled Contact to Service Contract 
$bo_act_serviceMaintenanceContracts.addEntitledContactsToServiceContract($serviceContractName, $contactName);

//Add Parts Pricing To Service Contract 
var $pricePerUnit = 150;
$bo_act_serviceMaintenanceContracts.addPartsPricingToServiceContract($serviceContractName, $productName, $pricePerUnit);

//Launch in delivery
$workOrderNo = $swat_act_workOrders.createWorkOrder($caseNumber, $accountName, $contactName, $IBName, "Open", "High", "Field Service");

// Perform Interactive Entitlement on WO using Service Contract
$bo_act_interactiveEntitlement_WO.performInteractiveEntitlementWO_UsingScon($workOrderNo, $serviceContractName);
var $actual_EntitlementType = _getText(_div(0,_rightOf(_cell("/Entitlement Type/"))));
var $ServiceContract_actual = _getText(_link(0,_rightOf(_cell("Service Contract"))));
_assertEqual($actual_EntitlementType,"INTERACTIVE","Actual and expected Entitlement Type are same");
_assertEqual($ServiceContract_actual,$serviceContractName,"Actual and expected Service Conract are same");
_wait(3000);
//$sfm_act_common.globalSearch($workOrderNo);
//$sfm_act_common.globalSearch($workOrderNo);
//_click(_link($workOrderNo));


_selectDomain("/svmx/"); 
_isVisible(_cell({title: ""+$wizardIDName+""}));
_assertVisible(_cell({title:""+$wizardIDName+""}),"Pass");

_click(_button($sfmName1));
_selectDomain();

_wait(10000);

_selectDomain();

$swat_act_addChildLines.createQuoteFromWOChildLines($productName);



//Add Parts Line to Above invoked TDM016 SFM
//$productName = "pro161201812055";


//After saving 'Create Quote from Work Order' process, Handover takes place. Hence
//'TDM016 - Manage Work Order Lines - Usage' process will be launched.


var $searchValue = $productName;
var $lineQty = "5";
var $pricePerUnit = 120;
//To reload a page if the field is not visible
_selectDomain();
var Order_Status = _label("Order Status:");
$swat_act_pageLoadWait.waitTillPageLoads(Order_Status);

_setValue(_textbox("Order Status:"), "Completed");

_selectDomain();
var Parts = _span("Parts");
$swat_act_pageLoadWait.waitTillPageLoads(Parts);

$bo_act_getPrice.addPartsLineToSFMDelivery($searchValue,$lineQty);
$bo_act_getPrice.calculateGetPrice();


$bo_act_getPrice.saveSFMDelivery();

//Add Parts Line to Above invoked TDM015 SFM
//Add a Parts Line

_click(_span("svmx-btn-icon svmx-sfmd-add-line-icon"));
_click(_image("svmx-action-col-icon svmx-action-col-0   svmx-sfmd-edit-icon"));


$bo_act_common.searchfunction($productName);
_setValue(_textbox("Line Qty:"), "5");
_click(_span("Update"));

//Add a Labor Line
$bo_act_getPrice.addLaborLineToSFMDelivery($searchValue, "service", "03", "05");


//Add a Expense Line
$bo_act_getPrice.addExpensesLineToSFMDelivery("Phone", "03", "3000");


//Add a Travel Line
$bo_act_getPrice.addTravelLineToSFMDeliveryUsingStartEndDate("01", "03");

_click(_span("svmx-btn-icon svmx-sfmd-save-icon"));

//Create Usage from Estimate 

$bo_act_getPrice.addPartsLineToSFMDelivery($searchValue,$lineQty);
//Add a Parts Line
_click(_span("svmx-btn-icon svmx-sfmd-add-line-icon"));
_click(_image("svmx-action-col-icon svmx-action-col-0   svmx-sfmd-edit-icon"));

$bo_act_common.searchfunction($productName);
_setValue(_textbox("Line Qty:"), "5");
//_setValue(_textbox("svmx-form-field svmx-form-required-field svmx-form-text svmx-form-focus svmx-field-form-focus svmx-field-default-form-focus"), "5");
//_setValue(_textbox("svmx-form-field svmx-form-required-field svmx-form-text svmx-form-invalid-field"), "4000");
_click(_span("Update"));

//Add a Labor Line
$bo_act_getPrice.addLaborLineToSFMDelivery($searchValue, "service", "03", "05");



//Add a Expense Line
$bo_act_getPrice.addExpensesLineToSFMDelivery("Phone", "03", "3000");


//Add a Travel Line
$bo_act_getPrice.addTravelLineToSFMDeliveryUsingStartEndDate("01", "03");

_click(_span("svmx-btn-icon svmx-sfmd-save-icon"));

_wait(30000, _isVisible(_button("Finalize")));
_click(_button("Finalize"));
_wait(30000, _isVisible(_link(0)));


$bo_act_accounts.deleteAccount($accountName);
$bo_act_installedProduct.deleteInstalledProduct($IBName);
//delete test data
/*
$bo_act_SFW.deleteSFMWizard($objName, $wizardIDName);
$bo_act_navigation.navigateToSfmTransactionDesigner();
$bo_act_SFM.deleteSFM($sfmName1);
$bo_act_SFM.deleteSFM($sfmName2);
$bo_act_SFM.deleteSFM($sfmName3);
$bo_act_SFM.deleteSFM($sfmName4);
///uncomment */
$BVT_TC_003_SFW_with_cloned_Wiz_steps.end();
