var $rs_10499 = _testcase("RS_10499","Verify Lookup Context Header to header.");
$rs_10499.start();

		//Pre_Requesite
		//Create Account
		var $Account=new Array();
		$Account[0]=$bo_act_common.generateRandomName("Acme_10499_");
		$Account[1]=$bo_act_common.generateRandomName("Warner_10499_");
		$AccountID=new Array();
		for (var $i = 0; $i < $Account.length; $i++) {
			$objName= "Account";
			$obJson = "{\"Name\":\""+$Account[$i]+"\"}";
			$filterValue=$sfm_act_restApiMethods.postRestApi($sfmlUsn,$sfmlPwd,$sfmClientId,$sfmConsumerSecret,$sfmOrgInstance,$objName,$obJson,"POST");
			$AccountID[$i]=$filterValue;
		}
		_log("Account1: "+$Account[0]+" and Account2: "+$Account[1]);

		//Create Contact for above created account
		$contactNameList = ["Leanne Tomlin","Howard Jones","Edward Stamos","James Smith","Scott Tiger"];
		var $lastName;
		var $userName=new Array();
		for (var $i = 0; $i <$contactNameList.length; $i++) {
			$objName= "Contact";
			$lastName=$bo_act_common.generateRandomName($contactNameList[$i]+"_");
			if ($i<$contactNameList.length-2) {
				$obJson="{\"LastName\":\""+$lastName+"\",\"AccountId\":\""+$AccountID[0]+"\"}";
			}else if ($i<$contactNameList.length-1) {
				$obJson="{\"LastName\":\""+$lastName+"\",\"AccountId\":\""+$AccountID[1]+"\"}";
			}else {
				$obJson="{\"LastName\":\""+$lastName+"\"}";
			}
			$filterValue=$sfm_act_restApiMethods.postRestApi($sfmlUsn,$sfmlPwd,$sfmClientId,$sfmConsumerSecret,$sfmOrgInstance,$objName,$obJson,"POST");
			_log($lastName);
			$userName[$i]=$lastName;
		}	
		
		//create Work orders
		$objName= "SVMXC__Service_Order__c";
		$obJson = "{\"SVMXC__Order_Status__c\":\"Open\",\"SVMXC__Order_Type__c\":\"Field Service\"}";
		$columnName = "Name";
		$filter="id";
		$filterValue=$sfm_act_restApiMethods.postRestApi($sfmlUsn,$sfmlPwd,$sfmClientId,$sfmConsumerSecret,$sfmOrgInstance,$objName,$obJson,"POST");
		$WONumber =$sfm_act_restApiMethods.getRestApi($sfmlUsn,$sfmlPwd,$sfmClientId,$sfmConsumerSecret,$sfmOrgInstance,"GET", $objName, $columnName, $filter, $filterValue);
		_log("WO number: "+$WONumber);
		

		// Login to App
		$bo_act_login.login($g_url,$sfmlUsn,$sfmlPwd);
		
		//clone standard SFM
		var $sfmNameToBeCloned="Manage Work Order Lines - Usage";
		var $sfmName=$bo_act_common.generateRandomName("rs_10499_");
		var $sfmTemplateSaveAsName=$bo_act_common.generateRandomName("SFM_Page_");
		var $sfmTemplate="SVMXSTD: Manage WO Usage Lines";
		var $fieldName=["Account","Contact"];
		var $containerName=["Order Status","Order Status"];
		$sfm_act_SFM.cloneTDM016($sfmNameToBeCloned, $sfmName, false, $sfmTemplateSaveAsName, $sfmTemplate, $fieldName, $containerName);
		
		//remove multiadd for part childline
		$sfm_act_SFM.partsMultiAdd("--None--");
		
		//Context lookup setting up on Work Order Header objectt
		_click(_f("main").s_textinput("/.*/").near(_f("main").uiftetextfield("Contact")));
		$sfm_act_Transactions.addLookupContext("", true,"Account", "Account ID");
		
	
		//Save SFM after adding context lookup
		_setStrictVisibilityCheck(true);
		_click($bo_pg_sfmTransactionAndDesigner.btn_pageLayoutSave);
		_wait(5000,_isVisible($bo_pg_sfmTransactionAndDesigner.btn_sfmpageSaveConfirmMsg));
		_click($bo_pg_sfmTransactionAndDesigner.btn_saveAndclose);
		_setStrictVisibilityCheck(false);
		
		//add sfm to wizard
		var $wizardObject="Work Order";
		var $wizardName1 =$wizardName[3];
		var $wizardType="SFM";
		var $profile="";
		var $handOver=false;
		_log("Wizard Name: "+$wizardName1);
		$sfm_act_wizards.addToWizard($wizardObject, $wizardName1, $wizardType, $sfmName, $handOver, $profile); 
				
		$sfm_act_common.globalSearchInLightning($WONumber);
		_setStrictVisibilityCheck(true);
		$sfm_act_createCustomWizard.clickWizardBtn($sfmName);
		_wait(5000,_isVisible(_div("/"+$sfmName+"/")));
		
	
		//***Work Order Header validation***//
		
		//Assert "No matching record" DVR
		_wait(3000,_isVisible($sfm_pg_sfmDesigner.txt_headerAccount));
		_setValue($sfm_pg_sfmDesigner.txt_headerAccount,$Account[0]);
		_click($sfm_pg_sfmDesigner.link_quickSave);
		if (_exists(_div("Price not calculated, because entitlement check has not been performed."))) {
			_click(_span("Ok"));
		}
		_wait(10000);
		_click($sfm_pg_sfmDesigner.btn_headerContactsearchIcon);
		_assertContainsText("/"+$Account[0]+"/",$sfm_pg_sfmDesigner.label_contextOverride);
		_click($sfm_pg_sfmDesigner.link_searchLink);
		_wait(5000,_isVisible(_link($userName[0])));
		for (var $i = 0; $i < $userName.length-2; $i++) {
			_assertExists(_link($userName[$i]));
		}
		_setValue($sfm_pg_sfmDesigner.btn_searchTextBox,$userName[3]);
		_click($sfm_pg_sfmDesigner.link_searchLink);
		_assertExists($sfm_pg_sfmDesigner.btn_noRecordMSG);
		
		//Uncheck context override checkbox
		_click($sfm_pg_sfmDesigner.btn_contextOverride);
		_setValue($sfm_pg_sfmDesigner.btn_searchTextBox,$userName[3]);
		_click($sfm_pg_sfmDesigner.link_searchLink);
		_wait(5000,_isVisible(_link($userName[3])));
		_assertExists(_link($userName[3]));
		_click($sfm_pg_sfmDesigner.btn_cancelContactWindow);
/*		
		//clear account and check contact without account search
		_setValue($sfm_pg_sfmDesigner.txt_headerAccount);
		_click($sfm_pg_sfmDesigner.btn_headerContactsearchIcon);
		_wait(5000,_isVisible(_div("/search/")));
		//_assertEqual("/Empty/",_getText($sfm_pg_sfmDesigner.label_contextOverride));
		_assertContainsText("/Empty/",$sfm_pg_sfmDesigner.label_contextOverride);
		_setValue($sfm_pg_sfmDesigner.btn_searchTextBox,$userName[3]);
		_click($sfm_pg_sfmDesigner.link_searchLink);
		_wait(5000,_isVisible(_link($userName[3])));
		_assertExists(_link($userName[3]));
		_setValue($sfm_pg_sfmDesigner.btn_searchTextBox,$userName[0]);
		_click($sfm_pg_sfmDesigner.link_searchLink);
		_wait(5000,_isVisible(_link($userName[0])));
		_assertNotExists(_link($userName[0]));
		_click($sfm_pg_sfmDesigner.btn_cancelContactWindow);
*/		
		
		$sfm_act_SFM.editCustomProcess($sfmName);
		_click($bo_pg_sfmTransactionAndDesigner.btn_screenDesigner);
		_click(_f("main").s_textinput("/.*/").near(_f("main").uiftetextfield("Contact")));
		$sfm_act_Transactions.addLookupContext("", true,"", "");
		//Save SFM after adding context lookup
		_setStrictVisibilityCheck(true);
		_click($bo_pg_sfmTransactionAndDesigner.btn_pageLayoutSave);
		_wait(5000,_isVisible($bo_pg_sfmTransactionAndDesigner.btn_sfmpageSaveConfirmMsg));
		_click($bo_pg_sfmTransactionAndDesigner.btn_saveAndclose);
		_setStrictVisibilityCheck(false);
		
		
		$sfm_act_common.globalSearchInLightning($WONumber);
		_setStrictVisibilityCheck(true);
		$sfm_act_createCustomWizard.clickWizardBtn($sfmName);
		_wait(5000,_isVisible(_div("/"+$sfmName+"/")));
		
		
		//Assert "No matching record" DVR
		_wait(3000,_isVisible($sfm_pg_sfmDesigner.txt_headerAccount));
		_setValue($sfm_pg_sfmDesigner.txt_headerAccount,$Account[0]);
		_click($sfm_pg_sfmDesigner.link_quickSave);
		if (_exists(_div("Price not calculated, because entitlement check has not been performed."))) {
			_click(_span("Ok"));
		}
		_wait(10000);
		_click($sfm_pg_sfmDesigner.btn_headerContactsearchIcon);
		//_assertContainsText("/"+$Account[0]+"/",$sfm_pg_sfmDesigner.label_contextOverride);
		_assertNotExists($sfm_pg_sfmDesigner.label_contextOverride);
		_click($sfm_pg_sfmDesigner.link_searchLink);
		_wait(5000,_isVisible(_link($userName[0])));
		for (var $i = 0; $i < $userName.length-2; $i++) {
			_assertExists(_link($userName[$i]));
		}
		
		
/*	
		_assertExists(_div("Account: No matching record(s) found for this keyword: "+$Account[0]+"   "));
		_wait(3000);
		
		//assert Multiple item found DVR
		_setValue($sfm_pg_sfmDesigner.txt_headerAccount,"AccountRS_10499_");
		_wait(2000);
		_click($sfm_pg_sfmDesigner.link_quickSave);
		_wait(5000,_isVisible(_div("Account: Multiple items found. Click lookup icon to refine search.")));
		_assertExists(_div("Account: Multiple items found. Click lookup icon to refine search."));
		_wait(3000);
		
		//Select from search
		_click($sfm_pg_sfmDesigner.link_accountInDVR);
		_wait(3000,_isVisible());		
		_click($sfm_pg_sfmDesigner.btn_headerAccountSearchIcon);
		_wait(10000,_isVisible(_div("/search/")));
		_setValue($sfm_pg_sfmDesigner.btn_searchTextBox,$Account[0]);
		_click($sfm_pg_sfmDesigner.link_searchLink);
		_wait(5000,_isVisible(_link($Account[0])));
		_click(_link($Account[0]));
		_wait(5000);
		
		
		//try to add fn to accomodate RS_6877-1,2
		
		//assert Multiple item found DVR on AutoContact Field
		_setValue($sfm_pg_sfmDesigner.txt_headerContact,"Jason");
		_wait(2000,_isVisible($sfm_pg_sfmDesigner.link_quickSave));
		_click($sfm_pg_sfmDesigner.link_quickSave);
		_wait(5000,_isVisible(_div("Contact: Multiple items found. Click lookup icon to refine search.")));
		_assertExists(_div("Contact: Multiple items found. Click lookup icon to refine search."));
		_wait(5000);
		
		//Select from search
		_click($sfm_pg_sfmDesigner.link_ContactInDVR);
		_click($sfm_pg_sfmDesigner.btn_headerContactsearchIcon);
		_wait(5000,_isVisible(_div("/search/")));
		_click($sfm_pg_sfmDesigner.link_searchLink);
		_wait(5000,_isVisible(_link($userName[2])));
		_assertExists(_link($userName[2]));
		_assertExists(_link($userName[3]));
		_click(_link($userName[2]));
		_wait(5000);
		_click($sfm_pg_sfmDesigner.link_quickSave);
		_wait(5000,_isVisible(_div("Price not calculated, because entitlement check has not been performed.")));
		if (_exists(_div("Price not calculated, because entitlement check has not been performed."))) {
			_click(_span("Ok"));
		}
		_wait(10000);
		_assertEqual($userName[2],_getText($sfm_pg_sfmDesigner.txt_headerContact));
		
		//assert Multiple item found DVR on Contact Field
		_setValue($sfm_pg_sfmDesigner.txt_headerAccount,$Account[1]);
		_setValue($sfm_pg_sfmDesigner.txt_headerContact,"Howard");
		_click($sfm_pg_sfmDesigner.link_quickSave);
		_wait(5000,_isVisible(_div("Price not calculated, because entitlement check has not been performed.")));
		if (_exists(_div("Price not calculated, because entitlement check has not been performed."))) {
			_click(_span("Ok"));
		}
		_wait(10000);
		_assertEqual($userName[5],_getText(_textbox("/inputEl/",_in(_div("Contact")))));
		_setStrictVisibilityCheck(false);
		_log("Work Order Header validation: End");


		
































$acc = "Acme";
$sfmName = $bo_act_common.generateRandomName("SFM_Auto_");
//$sfmName = "SFM_Auto_2011201714528";
$wizTitle = $bo_act_common.generateRandomName("SFM Wiz");
//$wizTitle = "sfm_wiz2011201714178";
$headersToAdd = ["Account","Contact"];
$sfmPgLayoutName =	$bo_act_common.generateRandomName("SFM_Auto_Page");
$bo_act_login.login($g_url,$bac_un,$bac_pwd);
$sfm_act_lightningConfig.switchToLightning();
$bo_act_navigation.navigateToSfmTransactionDesigner();
$sfm_act_Transactions.newsfm6877($sfmName,$sfmPgLayoutName,$headersToAdd,"Account","Account ID");
$bo_act_navigation.navigateToSfmWizard();
$sfm_act_createCustomWizard.chooseObject("Work Order");
$sfm_act_createCustomWizard.addManageWizSteps($wizTitle,"SFM",$sfmName);
$sfm_act_createCustomWizard.createBlankWo();
$sfm_act_createCustomWizard.clickWizardBtn($sfmName);
_setValue($sfm_pg_wizardWindow.txt_account,$acc);
_click($sfm_pg_wizardWindow.lookup_account);
_click($sfm_pg_wizardWindow.account_option);
_click($sfm_pg_wizardWindow.lookup_contact);
_click($sfm_pg_wizardWindow.btn_search);
var $divs= _collectAttributes("_div","/cell/","sahiText",_under(_div("AccountId"),20));
_log($divs.length);
for (var $i=1; $i<$divs.length; $i++) {
	if(_getText($divs[$i])!="Acme"){
		$count++;
	}
}
_log($count);
if($count==0){
	_log("Pass");
}
else{
	_fail("Fail");
}
//$sfm_act_createCustomWizard.verify6877("Acme");

*/
$rs_10499.end();	