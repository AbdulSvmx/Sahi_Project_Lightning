var $rs_10448 = _testcase("RS_10448","Verify Lookup prefilter using data types - Date Literal, Picklist and Record Type");
$rs_10448.start();


		//login to App
		$bo_act_login.login($g_url,$sfmlUsn,$sfmlPwd);
		
		//clone standard SFM
		var $sfmNameToBeCloned="Manage Work Order Lines - Usage";
		var $sfmName=$bo_act_common.generateRandomName("rs_10448_");
		var $sfmTemplateSaveAsName=$bo_act_common.generateRandomName("SFM_Page_");
		var $sfmTemplate="SVMXSTD: Manage WO Usage Lines";
		var $fieldName=["Parts Order",];
		var $containerName=["Order Status"];
		$sfm_act_SFM.cloneTDM016($sfmNameToBeCloned, $sfmName, false, $sfmTemplateSaveAsName, $sfmTemplate, $fieldName, $containerName);
		
		//Remove multi-add for part childline
		//$sfm_act_SFM.partsMultiAdd("--None--");
		
		//create lookup for case object in header
		$object="Parts Order";
		var $lookupTempName="";
		
		//lookup filter details
		var $fieldCombo=["Expected Receipt Date","Billing Type","Record Type ID"];
		var $conditionsCombo=["Equals","Equals","Equals"];
		var $operandTypeCombo=["Function","Value","Value"];
		var $operandValue=["Today","Loan","Shipment"];
		var $lookupAdvExpr="(1 AND 2) OR 3";
		var $lookupFilterDetails=[$fieldCombo,$conditionsCombo,$operandTypeCombo,$operandValue,$lookupAdvExpr];
		var $lookUpName=$bo_act_common.generateRandomName("rs_10448_lookup_");
		
		//lookup fields to add details
		$addToSearchList=[false,true,true];
		$addToDisplayList=[true,true,true];
		$addToBubbleList=[true,true,true];
		var $lookupFieldsToAdd=[$fieldCombo,$addToSearchList,$addToDisplayList,$addToBubbleList];
		
		$sfm_act_Transactions.createLookUp($object, $lookupTempName, $lookupFieldsToAdd, $lookupFilterDetails, $lookUpName,"","");
		
		
		//create lookup for case object in Child
		$object="Case";
		var $lookupTempName="SVMXSTD: Case Lookup";
		var $fieldCombo=["Subject","Priority","Actual Initial Response","Case Number"];
		var $conditionsCombo=["Equals","Equals","Equals","Equals"];
		var $operandTypeCombo=["Value","Value","Value","Value"];
		var $operandValue=["SVMX.CURRENTRECORDHEADER.SVMXC__Problem_Description__c","SVMX.CURRENTRECORDHEADER.SVMXC__Priority__c","SVMX.CURRENTRECORDHEADER.SVMXC__Preferred_Start_Time__c","SVMX.CURRENTRECORDHEADER.SVMXC__Invoice_Number__c"];
		var $lookupAdvExpr="1 AND 2 AND (3 OR 4)";
		var $lookupFilterDetails=[$fieldCombo,$conditionsCombo,$operandTypeCombo,$operandValue,$lookupAdvExpr];
		var $lookUpName=$bo_act_common.generateRandomName("rs_10448_lookup_");
		$sfm_act_Transactions.createLookUp($object, $lookupTempName, "", $lookupFilterDetails, $lookUpName,"Parts","");
		
		//Save SFM after adding context lookup
		RS10499_saveSFM();
		
		//Add sfm to lookup wizard
		var $wizardObject="Work Order";
		var $wizardName1 =$wizardName[3];
		var $wizardType="SFM";
		var $profile="";
		var $handOver=false;
		_log("Wizard Name: "+$wizardName1);
		$sfm_act_wizards.addToWizard($wizardObject, $wizardName1, $wizardType, $sfmName, $handOver, $profile);  
		
		//Create Parts Order using below variables
		var $partOrderNumber=new Array;
		$objName= "SVMXC__RMA_Shipment_Order__c";
		for (var $i = 0; $i < 4; $i++) {
			if ($i==0) {
				$obJson = "{\"SVMXC__Expected_Receive_Date__c\":\""+getToday()+"\",\"SVMXC__Billing_Type__c\":\"Loan\",\"RecordTypeId\":\""+012290000004Ri2AAE+"\"}";
			}else if ($i==1) {
				$obJson = "{\"SVMXC__Expected_Receive_Date__c\":\""+getToday()+"\",\"SVMXC__Billing_Type__c\":\"Contract\",\"RecordTypeId\":\""+012290000004Ri3AAE+"\"}";
			}else {
				$obJson = "{\"SVMXC__Expected_Receive_Date__c\":\""+getToday()+"\",\"SVMXC__Billing_Type__c\":\"Contract\",\"RecordTypeId\":\""+012290000004Ri2AAE+"\"}";
			}
			$columnName = "Name";
			$filter="id";
			//create a case
			$filterValue=$sfm_act_restApiMethods.postRestApi($sfmlUsn,$sfmlPwd,$sfmClientId,$sfmConsumerSecret,$sfmOrgInstance,$objName,$obJson,"POST");
			//get the caseNumber
			$partOrderNumber[$i] =$sfm_act_restApiMethods.getRestApi($sfmlUsn,$sfmlPwd,$sfmClientId,$sfmConsumerSecret,$sfmOrgInstance,"GET", $objName, $columnName, $filter, $filterValue);
			_log("Parts Order number: "+$partOrderNumber[$i]);
		}
		
		
		
		//Create Work order using below variables 
		$objName= "SVMXC__Service_Order__c";
		$obJson = "{\"SVMXC__Problem_Description__c\":\"Problem Description\",\"SVMXC__Priority__c\":\"High\",\"SVMXC__Preferred_Start_Time__c\":\"2018-08-22\",\"SVMXC__Invoice_Number__c\":\""+$caseNumber+"\"}";
		_log("Work Order json: "+$obJson);
		$columnName = "Name";
		$filter="id";
		//create a case
		$filterValue=$sfm_act_restApiMethods.postRestApi($sfmlUsn,$sfmlPwd,$sfmClientId,$sfmConsumerSecret,$sfmOrgInstance,$objName,$obJson,"POST");
		//get the caseNumber
		$WONumber =$sfm_act_restApiMethods.getRestApi($sfmlUsn,$sfmlPwd,$sfmClientId,$sfmConsumerSecret,$sfmOrgInstance,"GET", $objName, $columnName, $filter, $filterValue);
		_log("WO number: "+$WONumber);
		
		//Search WO and launch SFM
		RS104_searchWOandLaunchSFM($WONumber,$sfmName);
		
	
		//search and assert the case on work order
		$sfm_act_SFM.searchHeaderField("Parts Order", "");
		for (var $i = 0; $i < $partOrderNumber.length; $i++) {
			if ($i<$partOrderNumber.length-2) {
				_assertExists(_link($partOrderNumber[$i]));
			}else {
				_assertNotExists(_link($partOrderNumber[$i]));
			}
		}

		//Logout and login: this is code is added due to limitation of sahi.
		//Limitation: we cann't perform action on transaction page twice in single login
		$bo_act_navigation.navigateToHome();
		$sfm_act_lightningConfig.logoutInLightning();
		_wait(10000,_isVisible($bo_pg_login.txt_email));
		$bo_act_login.login($g_url,$sfmlUsn,$sfmlPwd);
		
		//Edit custom process
		$sfm_act_SFM.editCustomProcess($sfmName);
		_click($bo_pg_sfmTransactionAndDesigner.btn_screenDesigner);
		_wait(10000,_isVisible($bo_pg_sfmTransactionAndDesigner.txt_contactOnHeader));
		$sfm_act_Transactions.

		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		_click($bo_pg_sfmTransactionAndDesigner.txt_contactOnHeader);
		$sfm_act_Transactions.addLookupContext("", true,"Account", "Account ID");
		
		//Save SFM after adding context lookup
		RS10499_saveSFM();
		
		//search WO and launch the SFM
		RS10499_searchWOandLaunchSFM($WONumber,$sfmName);





function RS10448_saveSFM(){
	_setStrictVisibilityCheck(true);
	_click($bo_pg_sfmTransactionAndDesigner.btn_pageLayoutSave);
	_wait(5000,_isVisible($bo_pg_sfmTransactionAndDesigner.btn_sfmpageSaveConfirmMsg));
	_click($bo_pg_sfmTransactionAndDesigner.btn_saveAndclose);
	_setStrictVisibilityCheck(false);
};

function getToday(){
	var $currentTime = new Date();
	var $month = $currentTime.getMonth() + 1;
	var $day = $currentTime.getDate();
	var $year = $currentTime.getFullYear();
	var $ret=$year +"-"+$month +"-" +$day;
	_log("Today date: "+$ret);
	return $ret;
};

function RS10448_searchWOandLaunchSFM($WONumber,$sfmName){
	$sfm_act_common.globalSearchInLightning($WONumber);
	_setStrictVisibilityCheck(true);
	$sfm_act_createCustomWizard.clickWizardBtn($sfmName);
	_wait(5000,_isVisible(_div("/"+$sfmName+"/")));
}



/*
// Pre-Condition: Should have atleast 1 Part Order with the Pre-filter mentioned.
$sfmName = $bo_act_common.generateRandomName("SFM_Auto_");
//$sfmName = "SFM_Auto_1220187946";
$sfmPgLayoutName =	$bo_act_common.generateRandomName("SFM_Auto_Page");
$headersToAdd = ["Parts"];
$lookUpName = $bo_act_common.generateRandomName("Part_lkp_");
$wizTitle = $bo_act_common.generateRandomName("SFM Wiz");
$bo_act_login.login($g_url,$sfmlUsn,$sfmlPwd);
$sfm_act_lightningConfig.switchToLightning();
$bo_act_navigation.navigateToSfmTransactionDesigner();
_click($bo_pg_sfmTransactionAndDesigner.btn_newSFM);
_wait(10000);
_setValue($bo_pg_sfmTransactionAndDesigner.txt_name, $sfmName);
_setValue($bo_pg_sfmTransactionAndDesigner.txt_sfmTransactionId, "");
_setSelected($sfm_pg_screenDesigner.sel_createSFMTransaction, "as Standalone for the purpose of editing an existing record");
_setStrictVisibilityCheck(true);
_setValue($sfm_pg_screenDesigner.txt_targetObject,"");
_setValue($sfm_pg_screenDesigner.txt_targetObject,"Wo");
_wait(5000);
_click($sfm_pg_screenDesigner.lbl_workOrder);
_click($bo_pg_sfmTransactionAndDesigner.btn_screenDesigner);
_setValue($bo_pg_sfmTransactionAndDesigner.txt_sfmSavePageLayoutAs, $sfmPgLayoutName);
_setValue($bo_pg_sfmTransactionAndDesigner.txt_sfmSavePageLayoutAsId, $sfmPgLayoutName);
_wait(10000);
$sfm_act_Transactions.addHeader($headersToAdd);
_click(_f("main").s_button("Configure Lookup"));
_wait(5000);
_setValue($sfm_pg_screenDesigner.txt_lookupName, $lookUpName);
_setValue($sfm_pg_screenDesigner.txt_lookupId, "");
_setValue($sfm_pg_screenDesigner.txt_lookupId, $lookUpName);
_click(_f("main").s_button("Add a row"));
var $fields = ["Expected Receipt Date","Billing Type","Record Type ID"];
var $fields1 = ["Account","Billing Type","Record Type ID"];
_setSelected(_f("main").s_combobox("fieldCombo"), $fields[0]);
_setSelected(_f("main").s_dropdownlist("operandTypeCombo"), "Function");
var $clicks = 2;
for(var $i=1;$i<=$clicks;$i++){
	var $j = $i-1;
	_click(_f("main").s_button("+"));
	_setSelected(_f("main").s_combobox("fieldCombo["+$i+"]"), $fields[$i]);
}
_setValue(_f("main").s_textinput("advExpIP"), "(1 and 2) or 3");
$sfm_act_Transactions.addSearchDisplay($fields1);
_click(_f("main").s_button("Save[4]"));
_wait(3000);
_click($sfm_pg_screenDesigner.btn_lookupClose);
_click($bo_pg_sfmTransactionAndDesigner.btn_pageLayoutSave);
_wait(3000);
_click($bo_pg_sfmTransactionAndDesigner.btn_finalQuickSave);
$bo_act_navigation.navigateToSfmWizard();
$sfm_act_createCustomWizard.chooseObject("Work Order");
$sfm_act_createCustomWizard.addManageWizSteps($wizTitle,"SFM",$sfmName);
$woName=$sfm_act_createCustomWizard.createBlankWo();
_log($woName);
$sfm_act_createCustomWizard.clickWizardBtn($sfmName);
_selectDomain();
_setStrictVisibilityCheck(true);
_click($sfm_pg_wizardWindow.lookup_PartsOrder);
_click($sfm_pg_wizardWindow.icon_search);
var $divs= _collect("_div","/.*/ /*",_under(_div("Record Type ID")));
/*var $count = 0;
for(var $i=0;$i<$divs.length-1;$i++){
	if(_getText($divs[$i])!="RMA"&&_getText($divs[$i])!=""){
		$count++;
	}
}
if($count==0){
	_log("Pass");
}
else{
	_log("Fail");
}



*/
$rs_10448.end();