var $an_ana_9818 = _testcase("ANA-9818","SCON within Coverage of Covered Product with Work Order");
$an_ana_9818.start();
var $cred = _readExcelFile("../../analytics/an_excleData/credentials.xlsx","Sheet1",true);
var $un = $cred[1]["UserName"];
var $pwd =$cred[1]["Password"];
var $url =$cred[1]["url"];
var $data = _readExcelFile("../../analytics/an_excleData/MTTC_data.xlsx","Sheet1",true);
var $Account = $data[5]["Account"];
var $Technician = $data[1]["Technician"];
var $Product = $data[5]["Product"];
var $OrderStatus = $data[1]["OrderStatus"];
var $Component = $data[5]["Component"];
var $PreferredStartDate = $data[5]["PreferredStartDate"];
var $PreferredEndDate = $data[5]["PreferredEndDate"];
$bo_act_login.login($url, $un, $pwd);


// Create an IB

var $ana_9818_create_IB = "SVMXDEV__Installed_Product__c IB01 = new SVMXDEV__Installed_Product__c(SVMXDEV__Product__c='"+$Product+"',SVMXDEV__Company__c = '"+$Account+"' , Name = 'ANA-9818-IB' ,SVMXDEV__City__c='KGF');insert IB01;";
var $ana_9818_result_IB  = $op_act_sForceApiCall.sForceQuery($un, $pwd, $ana_9818_create_IB , "create");
_log($ana_9818_result_IB);
var $ana_9818_get_IB = "Select Id from SVMXDEV__Installed_Product__c where Name = 'ANA-9818-IB' Limit 1";
var $ana_9818_fetch_IB  = $op_act_sForceApiCall.sForceQuery($un, $pwd, $ana_9818_get_IB,"query");

_wait(5000);
var $var2;
var $ana_9818_IB_ID;
$ana_9818_IB_ID = $ana_9818_fetch_IB[0].Id ;
_log($ana_9818_IB_ID);
//_wait(30000);

// Create Work Order for the IB and SCON

	var $ana_9818_create_WO = "SVMXDEV__Service_Order__c WO1 = new SVMXDEV__Service_Order__c(SVMXDEV__Company__c='"+$Account+"',SVMXDEV__Component__c = '"+$ana_9818_IB_ID+"', SVMXDEV__Preferred_Start_Time__c = DateTime.valueOf("+$PreferredStartDate+"+0.025), SVMXDEV__Preferred_End_Time__c = DateTime.valueOf("+$PreferredEndDate+"+0.085), SVMXDEV__Order_Status__c = 'Completed',SVMXDEV__Order_Type__c='Field Service' ); insert WO1;";
	var $ana_9818_result_WO = $op_act_sForceApiCall.sForceQuery($un, $pwd, $ana_9818_create_WO , "create");
	var $ana_9818_get_WO = "Select Id, Name from SVMXDEV__Service_Order__c where Createdby.Id = '0050U000000Rpde' Order by CreatedDate DESC Limit 1";
	var $ana_9818_fetch_WO = $op_act_sForceApiCall.sForceQuery($un, $pwd, $ana_9818_get_WO,"query");
	var $ana_9818_WO_ID ;

$ana_9818_WO_ID = $ana_9818_fetch_WO[0].Id;
_log($ana_9818_WO_ID);	
//_wait(30000);

var $downtime="SVMXDEV__Down_Time__c downtime =new SVMXDEV__Down_Time__c(SVMXDEV__Service_Order__c='"+$ana_9818_WO_ID+"',SVMXDEV__Duration__c=60);insert downtime;";
var $downtime_result=$op_act_sForceApiCall.sForceQuery($un, $pwd, $downtime , "create");
var $ana_get_DT = "Select Id, Name from SVMXDEV__Down_Time__c where Createdby.Id = '0050U000000Rpde' Order by CreatedDate DESC Limit 1";
var $ana_fetch_DT = $op_act_sForceApiCall.sForceQuery($un, $pwd, $ana_get_DT,"query");
var ID;
$ana_fetch_DT.forEach(function($var) {
	$ID = $var.Id;
});

_log($ID);


//$an_act_MTBF.mtbf_closed_wo_calc();
$an_act_MTBF.mtbf_downtime("CAL-ANA-9818");
$an_act_MTBF.MTBF_runEngine("vinaya.v@ge.com");

	

/*

var $ana_9818_IB ;
var $ana_9818_Expected_uptime;
var $ana_9818_downtime;
var $ana_9818_wo_count;
var $ana_9818_Actual_uptime;
var $ana_9818_MTBF;



var $ana_9818_query= "Select SVMXDEV__Installed_Product__c,SVMXDEV__Actual_Uptime__c, SVMXDEV__Downtime__c,SVMXDEV__Expected_Uptime__c,SVMXDEV__MTBF__c,SVMXDEV__Product__c,SVMXDEV__Run_Date__c,SVMXDEV__workorder_count__c from SVMXDEV__SPM_Mean_Time_Between_Failure__c where SVMXDEV__Installed_Product__c = '"+$ana_9818_IB_ID+"'";
var $ana_9818_result = $op_act_sForceApiCall.sForceQuery($un, $pwd, $ana_9818_query,"query");

$ana_9818_result.forEach(function($var) {
	
	$ana_9818_IB = $var.SVMXDEV__Installed_Product__c;
	$ana_9818_Expected_uptime = $var.SVMXDEV__Expected_Uptime__c;
	$ana_9818_downtime = $var.SVMXDEV__Downtime__c;
	$ana_9818_wo_count = $var.SVMXDEV__workorder_count__c;
	$ana_9818_Actual_uptime=$var.SVMXDEV__Actual_Uptime__c;
    $ana_9818_MTBF=$var.SVMXDEV__MTBF__c;
});

_log($ana_9818_IB);
_log($ana_9818_Expected_uptime);
_log($ana_9818_downtime); 
_log($ana_9818_wo_count);

_assertNotNull($ana_9818_IB);
_assertNotNull($ana_9818_Expected_uptime);
_assertNotNull($ana_9818_downtime);
_assertNotNull($ana_9818_wo_count);
_assertNotNull($ana_9818_Actual_uptime);
_assertNotNull($ana_9818_MTBF);
*/
$an_ana_9818.end();





