/**
 * This Test-cases verified the multiple calculation method for Repeat visit when Top-level tracker is Case
 * Owner : Meghana
 *
 */


var $un = "meghana.rao@servicemax.com";
var $pwd = "salesforce100 ";
var $url = "https://test.salesforce.com";




var $an_rv_1050 = _testcase("ANA-1050","Case Multiple calculation method check for Repeat visit");
$an_rv_1050.start();
var $data = _readExcelFile("../analytics/an_excleData/ANA-1050.xlsx","Sheet1",true);
$bo_act_login.login($url, $un, $pwd);
$insert_case = $data[1]["InsertCase"];
var $Account = $data[1]["Account"];
var $Technician = $data[1]["Technician"];
var $Product = $data[1]["Component"];
var $OrderStatus = $data[1]["Order Status"];
var $Closedon = $data[1]["Closed on"];
var $Site = $data[1]["Site"];
var $resultCase = $op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_case , "create");
var $query_case = "Select Id from Case Order by CreatedDate DESC Limit 1";
var $insert_WO = "SVMXC__Service_Order__c  WO = new SVMXC__Service_Order__c (SVMXC__Company__c ='"+ $Account +"', SVMXC__Product__c = '"+$Product+"' , SVMXC__Group_Member__c = '"+$Technician+"' ,  SVMXC__Order_Status__c = '"+$OrderStatus+"' , SVMXC__Closed_On__c = "+$ClosedOn+", SVMXC__Case__c = '"+ $Case +", 	SVMXC__Country__c = 'United States', SVMXC__Sub_Status__c = 'Resolved');insert WO;";
var $query_wo = "Select Name , Id  , SVMXC__Company__c , SVMXC__Component__c , SVMXC__Closed_On__c from SVMXC__Service_Order__c Order by CreatedDate DESC Limit 1";
var $resultArr2 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_WO , "create");

var $resultArr = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_wo,"query");
var $WO_ID ;
var $WO_Account;
var $WO_ClosedOn;


$resultArr.forEach(function($arrValue) {
	
	  $WO_ID = $arrValue.Id;

});


$an_act_Repeat_Visit_SR.RV_USA_Calc("Repeat Visit Calc USA");
$an_act_Repeat_Visit_SR.RV_RunEngine("meghana.rao@servicemax.com");

var $query_RV = "Select SVMXC__Work_Order__c , SVMXC__Configuration_Name__c ,SVMXC__Is_Repeat_Visit__c ,SVMXC__Case__c from SVMXC__SPM_Repeat_Visit__c where SVMXC__Work_Order__c ='"+ $WO_ID +"'";
var $resultArr1 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_FTF,"query");

$resultArr1.forEach(function($arrValueFTF) {
	$Account_FTF = $arrValueFTF.SVMXDEV__Account__c;
	$IsFirstTimeFixed =  $arrValueFTF.SVMXDEV__Is_Fixed_First_Time__c;
    $FTF_Case = $arrValueFTF.SVMXDEV__Case__c;

});


$an_rv_1050.end();