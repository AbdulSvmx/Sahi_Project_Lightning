/**
 * This Test-cases verified the multiple calculation method for Repeat visit when Top-level tracker is Case
 * Owner : Meghana
 *
 */

function RV_Multi_Calc()
{
	

}

RV_Multi_Calc();

var $an_rv_1050 = _testcase("ANA-1050","Case Multiple calculation method check for Repeat visit");
$an_rv_1050.start();
var $un = "meghana.rao@servicemax.com";
var $pwd = "salesforce100";
var $url = "https://test.salesforce.com";
var $data = _readExcelFile("../analytics/an_excleData/ANA-1050.xlsx","Sheet1",true);
var $insert_case = $data[1]["InsertCase"];
var $Account = $data[1]["Account"];
var $Technician = $data[1]["Technician"];
var $Product = $data[1]["Product"];
var $OrderStatus = $data[1]["OrderStatus"];
var $Closedon = $data[1]["ClosedOn"];
var $Site = $data[1]["Site"];
var $Component = $data[1]["Component"];
$bo_act_login.login($url, $un, $pwd);

var $createcase = $op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_case, "create");//$op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_case , "create");
_log($createcase);
var $query_case = "Select Id from Case Order by CreatedDate DESC Limit 1";

var $Case ;
var $fetchcasequery = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_case,"query");
var $casedummy;
$fetchcasequery.forEach(function($casedummy) {
	$Case = $casedummy.Id;
		
});

var $insert_wo_first = "SVMXC__Service_Order__c  WO = new SVMXC__Service_Order__c (SVMXC__Company__c ='"+ $Account +"', SVMXC__Product__c = '"+$Product+"' , SVMXC__Group_Member__c = '"+$Technician+"' ,SVMXC__Component__c = '"+$Component+"',SVMXC__Order_Status__c = '"+$OrderStatus+"' , SVMXC__Closed_On__c = "+$Closedon+", SVMXC__Case__c = '"+ $Case +"',SVMXC__Country__c = 'United States', SVMXC__Sub_Status__c = 'Resolved', SVMXC__Priority__c = 'High', SVMXC__Site__c = '"+$Site+"');insert WO;";
var $query_wo_first = "Select Name , Id  , SVMXC__Company__c , SVMXC__Component__c , SVMXC__Closed_On__c from SVMXC__Service_Order__c Order by CreatedDate DESC Limit 1";
var $fetchwoquery = $op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_wo_first , "create");

var $store_first_wo = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_wo_first,"query");

var $WO_new_1 ;
var $WO_Account_1;
var $RV_WO_1;
var $RV_config_1;
var $RV_case_1;
var $Is_Repeat_visit_1;
var $WO_new_2 ;
var $WO_Account_2;
var $RV_WO_2;
var $RV_config_2;
var $RV_case_2;
var $Is_Repeat_visit_2;
var $arr_value_1;
var $arr_value_2;
var $arr_value_rv_1;
var $arr_value_rv_2;
var $wo1;
var $wo2;
$store_first_wo.forEach(function($wo1) {
	
	  $WO_new_1 = $wo1.Id;

});
_log($WO_new_1);

var $insert_wo_second = "SVMXC__Service_Order__c  WO = new SVMXC__Service_Order__c (SVMXC__Company__c ='"+ $Account +"', SVMXC__Product__c = '"+$Product+"' , SVMXC__Group_Member__c = '"+$Technician+"' ,SVMXC__Component__c = '"+$Component+"', SVMXC__Order_Status__c = '"+$OrderStatus+"' , SVMXC__Closed_On__c = "+$Closedon+", SVMXC__Case__c = '"+ $Case +"',SVMXC__Country__c = 'United Kingdom', SVMXC__Sub_Status__c = 'Resolved', SVMXC__Priority__c = 'High', SVMXC__Site__c = '"+$Site+"' );insert WO;";
var $query_wo_second = "Select Name , Id  , SVMXC__Company__c , SVMXC__Component__c , SVMXC__Closed_On__c from SVMXC__Service_Order__c Order by CreatedDate DESC Limit 1";
var $fetchwo2query = $op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_wo_second , "create");

var $store_sec_wo = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_wo_second,"query");

$store_sec_wo.forEach(function($wo2) {
	
	  $WO_new_2 = $wo2.Id;

});
_log($WO_new_2);

$TopLevelCase.an_TopLevelCase();
$an_act_Repeat_Visit_SR.RV_USA_Calc("Repeat Visit Calc USA");
$an_act_Repeat_Visit_SR.RV_UK_Calc("Repeat Visit Calc UK");
$an_act_Repeat_Visit_SR.RV_RunEngine("meghana.rao@servicemax.com");

_wait(30000);
_wait(1000);
var $ana_1050_query_RV1 = "Select SVMXC__Work_Order__c ,SVMXC__Account__c, SVMXC__Configuration_Name__c ,SVMXC__Is_Repeat_Visit__c ,SVMXC__Case__c from SVMXC__SPM_Repeat_Visit__c where SVMXC__Work_Order__c ='"+ $WO_new_1 +"'";
var $store_rv1 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $ana_1050_query_RV1,"query");

$store_rv1.forEach(function($arr_value_rv_1) {
	
	$WO_Account_1 = $arr_value_rv_1.SVMXC__Account__c;
	$RV_case_1 = $arr_value_rv_1.SVMXC__Case__c;
	$RV_config_1 = $arr_value_rv_1.SVMXC__Configuration_Name__c;
	$Is_Repeat_visit_1 = $arr_value_rv_1.SVMXC__Is_Repeat_Visit__c;
	
});


_log($RV_config_1);


var $ana_1050_query_RV2 = "Select SVMXC__Work_Order__c ,SVMXC__Account__c, SVMXC__Configuration_Name__c ,SVMXC__Is_Repeat_Visit__c ,SVMXC__Case__c from SVMXC__SPM_Repeat_Visit__c where SVMXC__Work_Order__c ='"+ $WO_new_2 +"'";
var $store_rv2 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $ana_1050_query_RV2,"query");

$store_rv2.forEach(function($arr_value_rv_2) {
	
	$WO_Account_2 = $arr_value_rv_2.SVMXC__Account__c;
	$RV_case_2 = $arr_value_rv_2.SVMXC__Case__c;
	$RV_config_2 = $arr_value_rv_2.SVMXC__Configuration_Name__c;
	$Is_Repeat_visit_2 = $arr_value_rv_2.SVMXC__Is_Repeat_Visit__c;
	
});

_log($RV_config_2);

_assertNotEqual($RV_config_1, $RV_config_2);

$an_rv_1050.end();