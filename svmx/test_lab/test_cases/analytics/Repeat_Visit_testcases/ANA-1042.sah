var $an_rv_1042 = _testcase("ANA-1042","Service Request Additional field check ");
$an_rv_1042.start();
var $un = "meghana.rao@servicemax.com";
var $pwd = "salesforce100";
var $url = "https://test.salesforce.com";
var $data = _readExcelFile("../../analytics/an_excleData/ANA-1050.xlsx","Sheet1",true);
var $insert_sr = $data[1]["InsertServiceRequest"];
var $Account = $data[1]["Account"];
var $Technician = $data[1]["Technician"];
var $Product = $data[1]["Product"];
var $OrderStatus = $data[1]["OrderStatus"];
var $Closedon = $data[1]["ClosedOn"];
var $Site = $data[1]["Site"];
var $Component = $data[1]["Component"];
$bo_act_login.login($url, $un, $pwd);

var $resultSR = $op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_sr, "create");//$op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_case , "create");
var $query_sr = "Select Id from SVMXC__Service_Request__c Order by CreatedDate DESC Limit 1";

var $SR ;
var $srValue;
var $resultSR = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_sr,"query");

$resultSR.forEach(function($srValue) {
	$SR = $srValue.Id;
		
});

var $insert_WO_1 = "SVMXC__Service_Order__c  WO = new SVMXC__Service_Order__c (SVMXC__Company__c ='"+ $Account +"', SVMXC__Product__c = '"+$Product+"' , SVMXC__Group_Member__c = '"+$Technician+"' ,SVMXC__Component__c = '"+$Component+"',SVMXC__Order_Status__c = '"+$OrderStatus+"' , SVMXC__Closed_On__c = "+$Closedon+",SVMXC__SM_Service_Request__c = '"+ $SR +"',SVMXC__Country__c = 'United States', SVMXC__Sub_Status__c = 'Resolved', SVMXC__Priority__c = 'High', SVMXC__Site__c = '"+$Site+"');insert WO;";
var $query_wo_1 = "Select Name , Id  , SVMXC__Company__c , SVMXC__Component__c , SVMXC__Closed_On__c from SVMXC__Service_Order__c Order by CreatedDate DESC Limit 1";
var $resultArr2 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_WO_1 , "create");

var $result$arr_1 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_wo_1,"query");

var $WO_1 ;
var $WO_Account_1;
var $RV_WO_1;
var $RV_config_1;
var $RV_case_1;
var $Is_Repeat_visit_1;
var $WO_2 ;
var $WO_Account_2;
var $RV_WO_2;
var $RV_config_2;
var $RV_case_2;
var $Is_Repeat_visit_2;
var $arr_1;
var $arr_2;
var $arr_rv_1;
var $arr_rv_2;

$result$arr_1.forEach(function($arr_1) {
	
	  $WO_1 = $arr_1.Id;

});
_log($WO_1);

var $insert_WO_2 = "SVMXC__Service_Order__c  WO = new SVMXC__Service_Order__c (SVMXC__Company__c ='"+ $Account +"', SVMXC__Product__c = '"+$Product+"' , SVMXC__Group_Member__c = '"+$Technician+"' ,SVMXC__Component__c = '"+$Component+"', SVMXC__Order_Status__c = '"+$OrderStatus+"' , SVMXC__Closed_On__c = "+$Closedon+",SVMXC__SM_Service_Request__c = '"+ $SR +"',SVMXC__Country__c = 'United States', SVMXC__Priority__c = 'High',SVMXC__Related_Work_Order__c ='"+$WO_1+"', SVMXC__Site__c = '"+$Site+"' );insert WO;";
var $query_wo_2 = "Select Name , Id  , SVMXC__Company__c , SVMXC__Component__c , SVMXC__Closed_On__c from SVMXC__Service_Order__c Order by CreatedDate DESC Limit 1";
var $resultArr3 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_WO_2 , "create");

var $resultArr_2 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_wo_2,"query");

$resultArr_2.forEach(function($arr_2) {
	
	  $WO_2 = $arr_2.Id;

});
_log($WO_2);


$TopLevelSR.an_topLevelSR();
$an_act_Repeat_Visit_SR.rv_runEngine("meghana.rao@servicemax.com");

_wait(30000);
_wait(1000);


var $query_RV = "Select SVMXC__Work_Order__c ,SVMXC__Account__c, SVMXC__Configuration_Name__c ,SVMXC__Is_Repeat_Visit__c ,SVMXC__Service_Request__c from SVMXC__SPM_Repeat_Visit__c where SVMXC__Work_Order__c ='"+ $WO_1 +"'";
var $resultArr1 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_RV,"query");

$resultArr1.forEach(function($arr_rv_1) {
	
	$WO_Account_f = $arr_rv_1.SVMXC__Account__c;
	$RV_sr_f = $arr_rv_1.SVMXC__Service_Request__c;
	$RV_config_f = $arr_rv_1.SVMXC__Configuration_Name__c;
	$Is_Repeat_visit_f = $arr_rv_1.SVMXC__Is_Repeat_Visit__c;
	
});


_log($Is_Repeat_visit_1);


var $query_RV_2 = "Select SVMXC__Work_Order__c ,SVMXC__Account__c, SVMXC__Configuration_Name__c ,SVMXC__Is_Repeat_Visit__c ,SVMXC__Service_Request__c from SVMXC__SPM_Repeat_Visit__c where SVMXC__Work_Order__c ='"+ $WO_2 +"'";
var $resultArr_3 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_RV_2,"query");

$resultArr_3.forEach(function($arr_rv_2) {
	
	$WO_Account_sec = $arr_rv_2.SVMXC__Account__c;
	$RV_sr_sec = $arr_rv_2.SVMXC__Service_Request__c;
	$RV_config_sec = $arr_rv_2.SVMXC__Configuration_Name__c;
	$Is_Repeat_visit_sec = $arr_rv_2.SVMXC__Is_Repeat_Visit__c;
	
});
_log($Is_Repeat_visit_sec);
_assertEqual("false", $Is_Repeat_visit_f);
_assertEqual("false", $Is_Repeat_visit_sec);
_assertEqual($SR,$RV_sr_f);


$an_rv_1042.end();

