var $an_rv_1053 = _testcase("ANA-1053","Custom Expression Service Request ");
$an_rv_1053.start();
var $un = "meghana.rao@servicemax.com";
var $pwd = "salesforce100";
var $url = "https://test.salesforce.com";
var $data = _readExcelFile("../../analytics/an_excleData/an_Datasheet1.xlsx","Sheet1",true);
var $insert_sr = $data[2]["InsertServiceRequest"];
var $Account = $data[1]["Account"];
var $Technician = $data[1]["Technician"];
var $Product = $data[1]["Product"];
var $OrderStatus = $data[1]["OrderStatus"];
var $Closedon = $data[1]["ClosedOn"];
var $Site = $data[1]["Site"];
var $Component = $data[1]["Component"];
$bo_act_login.login($url, $un, $pwd);

var $ana_1053_sr = $op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_sr, "create");//$op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_case , "create");
var $ana_1053_query_sr = "Select Id from SVMXC__Service_Request__c Order by CreatedDate DESC Limit 1";

var $service_request;
var $var1;
var $ana_1053_result_sr = $op_act_sForceApiCall.sForceQuery($un, $pwd, $ana_1053_query_sr,"query");
_wait(1000);
$ana_1053_result_sr.forEach(function($var1) {
	$service_request = $var1.Id;
		
});

var $ana_1053_insert_WO = "SVMXC__Service_Order__c  WO = new SVMXC__Service_Order__c (SVMXC__Company__c ='"+ $Account +"', SVMXC__Product__c = '"+$Product+"' , SVMXC__Group_Member__c = '"+$Technician+"' ,SVMXC__Component__c = '"+$Component+"',SVMXC__Order_Status__c = '"+$OrderStatus+"' , SVMXC__Closed_On__c = "+$Closedon+",SVMXC__SM_Service_Request__c = '"+ $service_request +"',SVMXC__Country__c = 'United States', SVMXC__Sub_Status__c = 'Resolved', SVMXC__Priority__c = 'High', SVMXC__Site__c = '"+$Site+"');insert WO;";
var $ana_1053_query_wo = "Select Name , Id  , SVMXC__Company__c , SVMXC__Component__c , SVMXC__Closed_On__c from SVMXC__Service_Order__c Order by CreatedDate DESC Limit 1";
var $ana_1053_result = $op_act_sForceApiCall.sForceQuery($un, $pwd, $ana_1053_insert_WO , "create");

var $ana_1053_fetch = $op_act_sForceApiCall.sForceQuery($un, $pwd, $ana_1053_query_wo,"query");
_wait(1000);
var $ana_1053_WO1 ;
var $ana_1053_WO_Account1;
var $ana_1053_RV_WO1;
var $ana_1053_Is_Repeat_visit1;
var $ana_1053_sr1;
var $ana_1053_RV_sr1;
var $ana_1053_WO2 ;
var $ana_1053_WO_Account2;
var $ana_1053_RV_WO2;
var $ana_1053_Is_Repeat_visit2;

var $var3;
var $varRV1;
var $ana_1053_sr2;
_wait(1000);
$ana_1053_fetch.forEach(function($ana_1053_var1) {
	
	$ana_1053_WO1 = $ana_1053_var1.Id;

});
_log($ana_1053_WO1);

var $ana_1053_insert_WO2 = "SVMXC__Service_Order__c  WO = new SVMXC__Service_Order__c (SVMXC__Company__c ='"+ $Account +"', SVMXC__Product__c = '"+$Product+"' , SVMXC__Group_Member__c = '"+$Technician+"' ,SVMXC__Component__c = '"+$Component+"', SVMXC__Order_Status__c = '"+$OrderStatus+"' , SVMXC__Closed_On__c = "+$Closedon+",SVMXC__SM_Service_Request__c = '"+ $service_request +"',SVMXC__Country__c = 'United States', SVMXC__Priority__c = 'High',SVMXC__Related_Work_Order__c ='"+$ana_1053_WO1+"', SVMXC__Site__c = '"+$Site+"' );insert WO;";
var $ana_1053_query_wo2 = "Select Name , Id  , SVMXC__Company__c , SVMXC__Component__c , SVMXC__Closed_On__c from SVMXC__Service_Order__c Order by CreatedDate DESC Limit 1";
var $resultArr3 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $ana_1053_insert_WO2 , "create");

var $ana_1053_result2 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $ana_1053_query_wo2,"query");
_wait(1000);
$ana_1053_result2.forEach(function($var3) {
	
	$ana_1053_WO2 = $var3.Id;

});
_log($ana_1053_insert_WO2);


$TopLevelSR.an_topLevelSR_custom();
$an_act_Repeat_Visit_SR.rv_runEngine("meghana.rao@servicemax.com");

_wait(30000);
_wait(1000);


var $ana_1053_query_RV1 = "Select SVMXC__Work_Order__c ,SVMXC__Account__c, SVMXC__Configuration_Name__c ,SVMXC__Is_Repeat_Visit__c ,SVMXC__Service_Request__c from SVMXC__SPM_Repeat_Visit__c where SVMXC__Work_Order__c ='"+ $ana_1053_WO1 +"'";
var $ana_1053_resultRV1 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $ana_1053_query_RV1,"query");
_wait(1000);
$ana_1053_resultRV1.forEach(function($varRV1) {
	
	$ana_1053_WO_Account1 = $varRV1.SVMXC__Account__c;
	$ana_1053_RV_sr1 = $varRV1.SVMXC__Service_Request__c;
	$ana_1053_Is_Repeat_visit1 = $varRV1.SVMXC__Is_Repeat_Visit__c;
	
});


_log($ana_1053_Is_Repeat_visit1);


var $ana_1053_query_RV2 = "Select SVMXC__Work_Order__c ,SVMXC__Account__c, SVMXC__Configuration_Name__c ,SVMXC__Is_Repeat_Visit__c ,SVMXC__Service_Request__c from SVMXC__SPM_Repeat_Visit__c where SVMXC__Work_Order__c ='"+ $ana_1053_WO2 +"'";
var $ana_1053_resultRV2 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $ana_1053_query_RV2,"query");
_wait(2000);
var $varRV2;
$ana_1053_resultRV2.forEach(function($varRV2) {
	
	$ana_1053_WO_Account2 = $varRV2.SVMXC__Account__c;
	$ana_1053_RV_sr2 = $varRV2.SVMXC__Service_Request__c;
	$ana_1053_Is_Repeat_visit2 = $varRV2.SVMXC__Is_Repeat_Visit__c;
	
});
_log($ana_1053_Is_Repeat_visit2);
_assertNotEqual("true", $ana_1053_Is_Repeat_visit1);
_assertEqual("false",$ana_1053_Is_Repeat_visit2);
_assertEqual($service_request,$ana_1053_RV_sr1);
_assertEqual($service_request,$ana_1053_RV_sr2);

$an_rv_1053.end();

