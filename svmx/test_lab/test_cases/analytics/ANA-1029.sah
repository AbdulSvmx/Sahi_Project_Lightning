var $an_rv_1061 = _testcase("ANA-1061","For Primary WO = YES and Service Request");
$an_rv_1061.start();
var $un = "meghana.rao@servicemax.com";
var $pwd = "salesforce100";
var $url = "https://test.salesforce.com";
var $data = _readExcelFile("../analytics/an_excleData/ANA-1050.xlsx","Sheet1",true);
var $insert_sr = $data[1]["InsertServiceRequest"];
var $Account = $data[1]["Account"];
var $Technician = $data[1]["Technician"];
var $Product = $data[1]["Product"];
var $OrderStatus = $data[1]["OrderStatus"];
var $Closedon = $data[1]["ClosedOn"];
var $Site = $data[1]["Site"];
var $Component = $data[1]["Component"];
$bo_act_login.login($url, $un, $pwd);

var $resultSR = $op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_sr, "create");//$op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_case , "create");
var $query_sr = "Select Id from SVMXC__Service_Request__c Order by CreatedDate DESC Limit 1";

var $SR1 ;
var $resultSR = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_sr,"query");

$resultSR.forEach(function($srValue) {
	$SR1 = $srValue.Id;
		
});

var $resultS2 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_sr, "create");//$op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_case , "create");
var $query_sr2 = "Select Id from SVMXC__Service_Request__c Order by CreatedDate DESC Limit 1";

var $SR2 ;
var $resultSR2 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_sr2,"query");

$resultSR2.forEach(function($srValue2) {
	$SR2 = $srValue2.Id;
		
});
var $insert_WO_1 = "SVMXC__Service_Order__c  WO = new SVMXC__Service_Order__c (SVMXC__Company__c ='"+ $Account +"', SVMXC__Product__c = '"+$Product+"' , SVMXC__Group_Member__c = '"+$Technician+"' ,SVMXC__Component__c = '"+$Component+"',SVMXC__Order_Status__c = '"+$OrderStatus+"' , SVMXC__Closed_On__c = "+$Closedon+", SVMXC__SM_Service_Request__c = '"+ $SR1 +"',SVMXC__Country__c = 'United States', SVMXC__Priority__c = 'High', SVMXC__Site__c = '"+$Site+"');insert WO;";
var $query_wo_1 = "Select Name , Id  , SVMXC__Company__c , SVMXC__Component__c , SVMXC__Closed_On__c from SVMXC__Service_Order__c Order by CreatedDate DESC Limit 1";
var $createWO1 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_WO_1 , "create");

var $resultArr_1 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_wo_1,"query");

var $WO_ID_1 ;
var $WO_Account_first;
var $RV_config_first;
var $Is_Repeat_visit_first;
var $WO_ID_2 ;
var $WO_Account_second;
var $RV_config_second;
var $Is_Repeat_visit_second;
var $RV_sr_second ;
var $RV_sr_first ;


$resultArr_1.forEach(function($arrValue1) {
	
	  $WO_ID_1 = $arrValue1.Id;

});
_log($WO_ID_1);

var $insert_WO_2 = "SVMXC__Service_Order__c  WO = new SVMXC__Service_Order__c (SVMXC__Company__c ='"+ $Account +"', SVMXC__Product__c = '"+$Product+"' , SVMXC__Group_Member__c = '"+$Technician+"' ,SVMXC__Component__c = '"+$Component+"',SVMXC__Order_Status__c = '"+$OrderStatus+"' , SVMXC__Closed_On__c = "+$Closedon+", SVMXC__SM_Service_Request__c = '"+ $SR2 +"',SVMXC__Country__c = 'United States', SVMXC__Priority__c = 'High', SVMXC__Site__c = '"+$Site+"',SVMXC__Sub_Status__c = 'Resolved', SVMXC__Related_Work_Order__c = '"+$WO_ID_1+"' );insert WO;";
var $query_wo_2 = "Select Name , Id  , SVMXC__Company__c , SVMXC__Component__c , SVMXC__Closed_On__c from SVMXC__Service_Order__c Order by CreatedDate DESC Limit 1";
var $createWO2 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_WO_2 , "create");

var $resultArr_2 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_wo_2,"query");

$resultArr_2.forEach(function($arrValue2) {
	
	  $WO_ID_2 = $arrValue2.Id;

});
_log($WO_ID_2);
$TopLevelSR.an_TopLevelSR();
$an_act_Repeat_Visit_SR.RV_RunEngine("meghana.rao@servicemax.com");

_wait(50000);
_log($WO_ID_1);
var $query_RV1 = "Select SVMXC__Work_Order__c ,SVMXC__Account__c, SVMXC__Configuration_Name__c ,SVMXC__Is_Repeat_Visit__c ,SVMXC__Service_Request__c from SVMXC__SPM_Repeat_Visit__c where SVMXC__Work_Order__c ='"+$WO_ID_1+"'";
var $resultArr1 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_RV1,"query");

_log($resultArr1);


$resultArr1.forEach(function($arrValueRV1) {
	
	$WO_Account_first = $arrValueRV1.SVMXC__Account__c;
	$RV_sr_first = $arrValueRV1.SVMXC__Service_Request__c;
	$RV_config_first = $arrValueRV1.SVMXC__Configuration_Name__c;
	$Is_Repeat_visit_first = $arrValueRV1.SVMXC__Is_Repeat_Visit__c;
	
});

var $query_RV2 = "Select SVMXC__Work_Order__c ,SVMXC__Account__c, SVMXC__Configuration_Name__c ,SVMXC__Is_Repeat_Visit__c ,SVMXC__Service_Request__c from SVMXC__SPM_Repeat_Visit__c where SVMXC__Work_Order__c ='"+ $WO_ID_2 +"'";
var $resultArr2 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_RV2,"query");

$resultArr2.forEach(function($arrValueRV2) {
	
	$WO_Account_second = $arrValueRV2.SVMXC__Account__c;
	$RV_sr_second = $arrValueRV2.SVMXC__Service_Request__c;
	$RV_config_second = $arrValueRV2.SVMXC__Configuration_Name__c;
	$Is_Repeat_visit_second = $arrValueRV2.SVMXC__Is_Repeat_Visit__c;
	
});


_assertEqual("true", $Is_Repeat_visit_first);

_assertEqual($SR1, $RV_sr_first);
_assertEqual("false", $Is_Repeat_visit_second);
_assertEqual($SR2, $RV_sr_second);
$an_rv_1061.end();

