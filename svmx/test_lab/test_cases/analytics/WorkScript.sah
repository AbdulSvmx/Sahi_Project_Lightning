var $data = _readExcelFile("../analytics/an_excleData/WorkScript.xlsx","Sheet1",true);
function FTF_CASE_pos()
{
	
}

FTF_CASE_pos ();

var $un = "meghana.svmxdev@servicemax.com";
var $pwd = "salesforce201";
var $url = "https://login.salesforce.com";

var $optimax_1000 = _testcase("optimax_1000","Verify query from sforce api");
$optimax_1000.start();
var $un = "meghana.svmxdev@servicemax.com";
var $pwd = "salesforce201";
var $url = "https://login.salesforce.com";

$insert_case = $data[1]["InsertCase"];
$bo_act_login.login($url, $un, $pwd);

var $resultCase = $op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_case, "create");//$op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_case , "create");
_log($resultCase);
var $query_case = "Select Id from Case Order by CreatedDate DESC Limit 1";

var $Case ;
var $resultCase = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_case,"query");

$resultCase.forEach(function($caseValue) {
	$Case = $caseValue.Id;
		
});

$insert_WO = "SVMXDEV__Service_Order__c  WO = new SVMXDEV__Service_Order__c (SVMXDEV__Company__c = '001F000001rO8EL', SVMXDEV__Product__c = '01t0G0000053Jb6' , SVMXDEV__Group_Member__c = 'a1D0G00000BhS5R' ,  SVMXDEV__Order_Status__c = 'Closed' , SVMXDEV__Closed_On__c = System.today(), SVMXDEV__Case__c = '"+ $Case +"');insert WO;";
var $query_wo = "Select Name , Id  , SVMXDEV__Company__c , SVMXDEV__Component__c , SVMXDEV__Closed_On__c from SVMXDEV__Service_Order__c Order by CreatedDate DESC Limit 1";
var $resultArr2 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $insert_WO , "create");

var $resultArr = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_wo,"query");
_log($resultArr);
var $WO_ID ;
var $Account;
var $ClosedOn;
var $Account_FTF;
var $IsFirstTimeFixed;

$resultArr.forEach(function($arrValue) {
	
	  $WO_ID = $arrValue.Id;
	  $Account = $arrValue.SVMXDEV__Company__c;
	  $ClosedOn = $arrValue.SVMXDEV__Closed_On__c;
		_log($WO_ID);

});
$optimax_1000.end();

//To setup the values
_click($an_pg_home.link_home);
_click($an_pg_home.link_servicemaxSetup);
_click($an_pg_home.div_serviceperformancemetrics);
_click($an_pg_home.div_serviceperformancemetricsetup);


_click($an_pg_home.span_businessprocessconfig);
_click($an_pg_home.text_issuetracker);
_click($an_pg_home.listItemCase);
_click($an_pg_home.BusinessQualificationExpr);
_click($an_pg_home.closedcases);
_click($an_pg_home.save);
_click($an_pg_home.click_OK);
_click($an_pg_home.click_metrics);
_click($an_pg_home.click_add);
_click($an_pg_home.Activecheckbox);
_setValue($an_pg_home.FTFCalmethod ,"FTF-Calculation method 1");
_click($an_pg_home.clicksettings);
_click($an_pg_home.clickCriteria);
_click($an_pg_home.FTFCalmethod);
_click($an_pg_home.closedcases);
_click($an_pg_home.save);
_click($an_pg_home.click_OK);
_wait(300);


// To Run the Engine
//_include("ScheduleRun.sah");
//ScheduleRun();
_click($an_pg_home.click_Schedule_Notifications);
_click($an_pg_home.text_Email_onSuccess);
_setValue($an_pg_home.text_Email_onSuccess, "meghana.rao@servicemax.com");
_click($an_pg_home.save);
_click($an_pg_home.click_OK);
_wait(300);
_click($an_pg_home.click_run);
_click($an_pg_home.click_OK);
_wait(1000);
$optimax_1000.start();
$bo_act_login.login($url, $un, $pwd);
var $query_FTF = "Select SVMXDEV__Is_Fixed_First_Time__c, SVMXDEV__Case__c , SVMXDEV__Work_Order__c, SVMXDEV__Account__c from SVMXDEV__SPM_First_Time_Fix__c where SVMXDEV__Work_Order__c = '"+ $WO_ID +"'" ;
var $resultArr1 = $op_act_sForceApiCall.sForceQuery($un, $pwd, $query_FTF,"query");
_log($resultArr1);

	 $resultArr1.forEach(function($arrValueFTF) {
			$Account_FTF = $arrValueFTF.SVMXDEV__Account__c;
			$IsFirstTimeFixed =  $arrValueFTF.SVMXDEV__Is_Fixed_First_Time__c;
		    $FTF_Case = $arrValueFTF.SVMXDEV__Case__c;
	  
		});
	 _assertEqual($data[1]['Account'], $Account_FTF);
     _assertEqual($Case ,$FTF_Case );
	 _assertEqual("false",$IsFirstTimeFixed);
	 


$optimax_1000.end();




	