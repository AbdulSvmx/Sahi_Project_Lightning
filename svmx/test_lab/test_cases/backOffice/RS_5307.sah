
//author - Nagendra Prasad

var $RS_5307 = _testcase("$RS_5307","Get Price on WO:IB covered under SCON and part pricing provided");
$RS_5307.start();
_setSpeed(100);

<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD

=======
>>>>>>> parent of cab5104... Merge branch 'master' of https://github.com/noorsalmasvmx/Sahi_Project
/**
 * Login to the Sandbox Org
 */

$bo_act_login.login($g_url, $g_un, $g_pwd);

//Pre - Condition Test Data
var $productFamily = ["--None--","GeneralSolution","AdvSolution","Accessory", "Storage"];
var $productCode = "";
var $seperator = "/";

/**
* Create Account, Contact, Product and Installed Product
*/
var $accountName = $bo_act_accounts.createAccount();
var $contactName = $bo_act_contacts.createContact($accountName);
var $productName = $bo_act_products.createProduct($productCode, $productFamily[3]);
var $IBName = $bo_act_installedProduct.createInstalledProduct($productName, $accountName, $contactName);

/**
 * Create SLA Terms
 */
var $slaName = $bo_act_slaTerms.createSlaTerms("Default");
$bo_act_slaTerms.addInitialResponseToSLA($slaName,"WorkOrder","Field Service","Medium","Created Date","5","10","SLA");
$bo_act_slaTerms.addOnsiteResponseToSLA($slaName,"WorkOrder","Field Service","Medium","Created Date","10","15","SLA");

//validation of SLA creation
_assertExists(_span($slaName));

/**
 * Create Service Contract(With child lines) and Activate it
 */
var $pastYear = 2;  // Start Date for Service Contract
var $futureYear = 2;  // End Date for Service Contract

// Creation of Service Contracts
var $serviceConractName = $bo_act_serviceMaintenanceContracts.createServiceMaintenanceContract($accountName, $slaName, $futureYear, $pastYear);

//Activating Created Service Contract
$bo_act_serviceMaintenanceContracts.activateServiceContract($serviceConractName);

//Edit Service Contract to add Contract information
$bo_act_serviceMaintenanceContracts.editServiceMaintenanceContract($serviceConractName, $contactName);

// Add Covered Product to Service Contract 

var $pastYear = 3;  			// Start Date 'TODAY's' Date - 3 YEARS
var $futureYear = 3;			// End Date 'TODAY's' Date + 3 YEARS

$bo_act_serviceMaintenanceContracts.AddCoveredProducToServiceContract($serviceConractName, $IBName, $slaName, $pastYear, $futureYear);

//Add Entitled Contact to Service Contract 

$bo_act_serviceMaintenanceContracts.addEntitledContactsToServiceContract($serviceConractName, $contactName);

// Add Parts Pricing To Service Contract 
var $pricePerUnit = 150;
$bo_act_serviceMaintenanceContracts.addPartsPricingToServiceContract($serviceConractName, $productName, $pricePerUnit);

var $expecctedIBUnder_CoveredProduct =  _getText(_link(0,_under(_tableHeader("Installed Product"))));
var $expecctedContactUnder_EntitledContacts =  _getText(_link(0,_under(_tableHeader("Contact"))));

//validation
//Validating the Covered Products Percent on Scon
_assertEqual($expecctedIBUnder_CoveredProduct,$IBName,"Actual and expected covered Products are not same");

//Validating the Entitled Contacts Percent on Scon
_assertEqual($expecctedContactUnder_EntitledContacts,$contactName,"Actual and expected Entitled Contacts are not same");

/**
* Create Case record
*/
var $caseStatus = "New";
var $casePriority = "Medium";
var $caseOrigin = "Phone";
var $caseNumber = $bo_act_Cases.createCase($caseStatus, $casePriority, $caseOrigin);

/**
* Create SFM Wizard for WO with two Steps 1st-Check Entitlement and 2nd- Manage Work Order Lines - Usage(TDM016)
*/

var $wizardTitleName = $bo_act_common.generateRandomName("SFWTitle");
var $wizardIDName = $bo_act_common.generateRandomName("SFWId");

$bo_act_navigation.navigateToSfmWizard();
$bo_act_SFW.createWizardGeneralInfo("Work Order", $wizardTitleName, $wizardIDName);
$bo_act_SFW.createWizardStep("SFM", "Manage Work Order Lines - Usage", "Interactive");
$bo_act_SFW.quickSaveSFWizard();


//Navigate to IB and Create WO from IB
var $WONumber = $bo_act_installedProduct.createWOFromIB($IBName);

//Edit The Above created WO for few fields
<<<<<<< HEAD

=======
=======
>>>>>>> parent of cbe26e5... commit
//PreCondition 
$bo_act_login.login($g_url, $bac_unDev, $bac_pwdDev);
var $accName = $bo_act_accounts.createAccount();
var $contactName = $bo_act_contacts.createContact($accName);
var $proName = $bo_act_products.createProduct("pro12", "--None--");
var $installedProduct = $bo_act_installedProduct.createInstalledProduct($proName,$accName,$contactName);
var $slaTermName = $bo_act_slaTerms.createSlaTerms("Default");
var $sconName = $bo_act_serviceMaintenanceContracts.createServiceMaintenanceContract($accName, $slaTermName, 2, 0);
$bo_act_serviceMaintenanceContracts.activateServiceContract($sconName);
//Adding covered product to Scon
$bo_act_serviceMaintenanceContracts.AddCoveredProducToServiceContract($sconName, $installedProduct, $slaTermName, 2, 1);
$bo_act_serviceMaintenanceContracts.addPartsPricingToServiceContract($sconName, $proName, 300);
var $WONumber = $bo_act_installedProduct.createWOFromIB($installedProduct);

// Editing the Above created WO
<<<<<<< HEAD
>>>>>>> parent of cbe26e5... commit
=======
>>>>>>> parent of cab5104... Merge branch 'master' of https://github.com/noorsalmasvmx/Sahi_Project
=======
>>>>>>> parent of cbe26e5... commit
$bo_act_workOrders.editWorkOrder($WONumber);
var $accountObject = _textbox("/Account/");
var $contactObject = _textbox("/Contact/");
$bo_act_workOrders.updateTextBoxFields($accountObject, $accName);
$bo_act_workOrders.updateTextBoxFields($contactObject, $contactName);

$bo_act_workOrders.checkEntitlement($WONumber);
<<<<<<< HEAD



<<<<<<< HEAD
<<<<<<< HEAD

$bo_act_getPrice.navigateToSFMDeliveryPageFor_TDM016($WONumber);

=======
$bo_act_getPrice.navigateToSFMDeliveryPageFor_TDM016($WONumber);
>>>>>>> parent of cab5104... Merge branch 'master' of https://github.com/noorsalmasvmx/Sahi_Project

//Add Parts Line to Above invoke TDM016 SFM
var $searchValue = $productName;
var $lineQty = "3";
$bo_act_getPrice.addPartsLineToSFMDelivery($searchValue,$lineQty);
$bo_act_getPrice.calculateGetPrice();

//Validation of Get Price for Parts lines
$bo_act_getPrice.editPartsLineToSFMDelivery($searchValue);

var $PartsLinePricePerUnitActual = _getText(_textbox(0,_rightOf(_label("/Line Price Per Unit/"))));
var $PartsCoveredActual = _getText(_textbox(0,_rightOf(_label("/Covered %/"))));
var $PartsDiscountActual = _getText(_textbox(0,_rightOf(_label("/Discount %/"))));
var $PartsBillableQtyActual = _getText(_textbox(0,_rightOf(_label("/Billable Qty/"))));
var $PartsBillableLinePriceActual = _getText(_textbox(0,_rightOf(_label("/Billable Line Price/"))));

var $BillableLinePriceExpected = $lineQty*$pricePerUnit;

_assertEqual($PartsLinePricePerUnitActual,$pricePerUnit,"Actual and expected Parts Line Price Per Unit are not same");
_assertEqual($PartsBillableQtyActual,$lineQty,"Actual and expected Parts Billable Qty are not same");
_assertEqual($PartsBillableLinePriceActual,$BillableLinePriceExpected,"Actual and expected Parts Billable Line Price are not same");
_assertEqual($PartsCoveredActual,"0","Actual and expected Parts Covered % are not same");
_assertEqual($PartsDiscountActual,"0","Actual and expected Parts Discount % are not same");

$bo_act_getPrice.closeEditedWOLineToSFMDelivery();

$bo_act_getPrice.saveSFMDelivery();

/**
*Clean up function
*/

var $datacreated = [$WONumber,$caseNumber,$IBName,$productName,$contactName,$accountName,$slaName,$serviceConractName];
=======
// _assertValue ( Billableline price,Line price per unit)
//Clean up function

var $datacreated = [$warrantyName,$IBName,$locationName,$productName,$contactName,$accountName,];
>>>>>>> parent of cbe26e5... commit
=======



// _assertValue ( Billableline price,Line price per unit)
//Clean up function

var $datacreated = [$warrantyName,$IBName,$locationName,$productName,$contactName,$accountName,];
>>>>>>> parent of cbe26e5... commit
for (var i = 0; i < $datacreated.length; i++) {
	$bo_act_common.cleanUpfunction($datacreated[i]);
}
$bo_act_login.logOut();

$RS_7288.end();

