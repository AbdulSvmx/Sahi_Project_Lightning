var $user_credentials_xls = $excel.readFromCustomExcel("../optimax/op_excleData/automation.xlsx", "User_Details","","");
var $businessHour_xls = $excel.readFromCustomExcel("../optimax/op_excleData/automation.xlsx", "BusinessHours","","");
var $territory_xls = $excel.readFromCustomExcel("../optimax/op_excleData/automation.xlsx", "SVMXC__Territory__c","","");
var $team_xls = $excel.readFromCustomExcel("../optimax/op_excleData/automation.xlsx", "SVMXC__Service_Group__c","","");
var $tech_xls = $excel.readFromCustomExcel("../optimax/op_excleData/automation.xlsx", "SVMXC__Service_Group_Members__c","","");
var $skill_xls = $excel.readFromCustomExcel("../optimax/op_excleData/automation.xlsx", "SVMXC__Skill__c","","");
var $Account_xls = $excel.readFromCustomExcel("../optimax/op_excleData/automation.xlsx", "Account","","");
var $rec_Pref_xls = $excel.readFromCustomExcel("../optimax/op_excleData/automation.xlsx", "SVMXC__Resource_Preference__c","","");
var $exp_xls = $excel.readFromCustomExcel("../optimax/op_excleData/automation.xlsx", "SVMXC__Service_Group_Skills__c","","");
var $RS_6694 = $excel.readFromCustomExcel("../optimax/op_excleData/automation.xlsx", "RS_6694","","");

for(var $i=0;$i<$user_credentials_xls.length;$i++)
{
	var $g_un = $user_credentials_xls[$i][0];
	var $g_pwd = $user_credentials_xls[$i][1];
	var $g_url = $user_credentials_xls[$i][2];
}

for(var $i=0;$i<$businessHour_xls.length;$i++)
{
	var $name_BH = $businessHour_xls[$i][1];
	_log("$name_BH = "+$name_BH);
}

$bo_act_login.login($g_url, $g_un, $g_pwd);

//var $rowIndex = 1;

//_log($rowIndex);
_set($login_result, _fetch(login($g_un,$g_pwd)));
_log($login_result);

_set($acc_creation, _fetch(createAcc($Account_xls)));
_log($acc_creation);
if($acc_creation != null && $acc_creation != false){
	$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "Account", "Id", $acc_creation, 1);
//updating acc in prf resource
for(var $e=0;$e<$rec_Pref_xls.length;$e++){
	$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Resource_Preference__c", "SVMXC__Company__c", $acc_creation,(1+$e));
}
//updating the acc in RS_6694
for(var $a=0;$a<$RS_6694.length;$a++){
	$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "RS_6694", "SVMXC__Company__c", $acc_creation,(1+$a));
}
_set($BH_creation, _fetch(createBH($businessHour_xls,$name_BH)));
_log($BH_creation);
$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "BusinessHours", "Id", $BH_creation, 1);
//updating the BH in RS_6694
for(var $b=0;$b<$RS_6694.length;$b++){
	$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "RS_6694", "SVMXC__Preferred_Business_Hours__c", $BH_creation,(1+$b));
}
//updating bh in tech
for(var $a=0;$a<$tech_xls.length;$a++){
	$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Service_Group_Members__c", "SVMXC__Working_Hours__c", $BH_creation,(1+$a));
}
//updating bh in territory
for(var $d=0;$d<$territory_xls.length;$d++){
	$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Territory__c", "SVMXC__Territory_s_Business_Hours__c", $BH_creation,(1+$d));
}
if($BH_creation != null){
	_log("business hour = "+$BH_creation);
	_set($territory_creation, _fetch(createTerritory($territory_xls,$BH_creation)));
	_log($territory_creation);
	$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Territory__c", "Id", $territory_creation, 1);
	//updating territory id in tech
	for(var $b=0;$b<$tech_xls.length;$b++){
		$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Service_Group_Members__c", "SVMXC__Service_Territory__c", $territory_creation,(1+$b));
	}
	//updating the territory in RS_6694
	for(var $a=0;$a<$RS_6694.length;$a++){
		$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "RS_6694", "SVMXC__Primary_Territory__c", $territory_creation,(1+$a));
	}
	if($territory_creation != false){
		_set($createTeam_creation, _fetch(createTeam($team_xls)));
		_log($createTeam_creation);
		$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Service_Group__c", "Id", $createTeam_creation,1);
		//updating team id in tech
		for(var $c=0;$c<$tech_xls.length;$c++){
			$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Service_Group_Members__c", "SVMXC__Service_Group__c", $createTeam_creation,(1+$c));
		}
		for(var $j=0;$j<$exp_xls.length;$j++){
			$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Service_Group_Skills__c", "SVMXC__Service_Group__c", $createTeam_creation,(1+$j));
		}
		if($createTeam_creation != false){
			_set($createTech_creation, _fetch(createTech($territory_creation,$BH_creation,$createTeam_creation,$tech_xls)));
			_log($createTech_creation);
			if($createTech_creation.length != 0 && $createTech_creation != false && $createTech_creation != null){
				_log("$createTech_creation[i] = "+$createTech_creation.length);
				_log("$createTech_creation[i] = "+$createTech_creation);
				//updating tech id in tech excel
				for(var $i = 0; $i < $createTech_creation.length; $i++){
					_log("$createTech_creation[i] = "+$createTech_creation[$i]);
					$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Service_Group_Members__c", "Id", $createTech_creation[$i],(1+$i));
				}
				//updating tech id in expertise
				for(var $g=0;$g<$exp_xls.length;$g++){
					$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Service_Group_Skills__c", "SVMXC__Group_Member__c", $createTech_creation[$g],(1+$g));
				}
				//updating tech id in prf res
				for(var $g=0;$g<$rec_Pref_xls.length;$g++){
					$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Resource_Preference__c", "SVMXC__Group_Member__c", $createTech_creation[$g],(1+$g));
				}
				//creating skills
					_set($createSkill_creation, _fetch(createSkills($skill_xls)));
					_log($createSkill_creation);
					if($createSkill_creation.length != 0 && $createSkill_creation != false && $createSkill_creation != null){
						for(var $f=0;$f<$skill_xls.length;$f++){
							$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Skill__c", "Id", $createSkill_creation[$f],(1+$f));
						}
						_log("skill update is done")
						//need to look into it
						for(var $h=0;$h<$exp_xls.length;$h++){
							_log("exp_xls.length = "+$exp_xls.length);
							_log("h = "+$h);
							if($h > 2){
								$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Service_Group_Skills__c", "SVMXC__Skill__c", $createSkill_creation[1],(1+$h));
							}
							else{
								$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Service_Group_Skills__c", "SVMXC__Skill__c", $createSkill_creation[0],(1+$h));
							}
						}
						_set($createExp_creation, _fetch(createExpertise($exp_xls)));
						_log($createExp_creation);
						if($createExp_creation.length != 0 && $createExp_creation != false && $createExp_creation != null){
							for(var $j=0;$j<$createExp_creation.length;$j++){
								$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Service_Group_Skills__c", "Id", $createExp_creation[$j],(1+$j));
							}
							_set($createPrfRes_creation, _fetch(createPrfRes($rec_Pref_xls)));
							_log($createPrfRes_creation);
							if($createPrfRes_creation.length != 0 && $createPrfRes_creation != false && $createPrfRes_creation != null){
								for(var $k=0;$k<$createPrfRes_creation.length;$k++){
									$excel.insertUnderColumn("../optimax/op_excleData/automation.xlsx", "SVMXC__Resource_Preference__c", "Id", $createPrfRes_creation[$k],(1+$k));
								}
							}
						}
					}
				}
			}
			else {
				_logExceptionAsFailure("Tech is not created as expected");
			}
		}
	}
}




//$excel.writeToExcel("insertAtIndex", "../optimax/op_excleData/automation.xlsx", "BusinessHours", $BH_creation, $rowIndex);


//<browser>

function login($g_un,$g_pwd)
{
	var $login_result = sforce.connection.login($g_un,$g_pwd);
	return $login_result;
}

function createAcc($Account_xls){
	var $isSuccess = false;
	var createAcc =[];
	for(var $i=0;$i<$Account_xls.length;$i++){
		var acc = new sforce.SObject("Account");
		acc.Name = $Account_xls[$i][0];
		createAcc.push(acc);
	}
	var $acc_result = _call(sforce.connection.create(createAcc));
	_log("$acc_result = "+$acc_result);
	_log("$acc_result Id = "+$acc_result[0].Id);
	_log("$acc_result id = "+$acc_result[0].id);
	if($acc_result[0].id != null){
		$isSuccess = true;
		return $acc_result[0].id;
	}
	return $isSuccess;
}

function createBH($businessHour_xls,$name_BH)
{
	var createBh = [];
	var $isSuccess = false;
	for(var $i=0;$i<$businessHour_xls.length;$i++)
	{
		var bh = new sforce.SObject("BusinessHours");
		bh.Name = $businessHour_xls[$i][1];
		bh.IsActive = $businessHour_xls[$i][2];
		bh.TimeZoneSidKey = $businessHour_xls[$i][3];
		bh.MondayStartTime = $businessHour_xls[$i][4];
		bh.MondayEndTime = $businessHour_xls[$i][5];
		bh.TuesdayStartTime = $businessHour_xls[$i][6];
		bh.TuesdayEndTime = $businessHour_xls[$i][7];
		bh.WednesdayStartTime  = $businessHour_xls[$i][8];
		bh.WednesdayEndTime = $businessHour_xls[$i][9];
		bh.ThursdayStartTime = $businessHour_xls[$i][10];
		bh.ThursdayEndTime = $businessHour_xls[$i][11];
		bh.FridayStartTime = $businessHour_xls[$i][12];
		bh.FridayEndTime = $businessHour_xls[$i][13];
		bh.SaturdayStartTime = $businessHour_xls[$i][14];
		bh.SaturdayEndTime = $businessHour_xls[$i][15];
		bh.SundayStartTime = $businessHour_xls[$i][16];
		bh.SundayEndTime = $businessHour_xls[$i][17];
		createBh.push(bh);
	}
	var bh_result = _call(sforce.connection.create(createBh));
	_log("bh_result id = "+bh_result[0].id);
	if(bh_result[0].id === null){
		var list_BH = sforce.connection.queryAll("Select Id, Name From BusinessHours Where Name = '"+$name_BH+"'");
		_log(" list_BHsize = "+list_BH.size);
		var arr_BH = list_BH.getArray("records");
		_log(" arr_BH Id = "+arr_BH[0].Id);
		return arr_BH[0].Id;
	}
	return bh_result[0].id;
}

function createTerritory($territory_xls,$BH_creation){
	var Territories = [];

	_log("$territory_xls.length = "+$territory_xls.length);
	for(var $i=0;$i<$territory_xls.length;$i++)
	{
		var territory = new sforce.SObject("SVMXC__Territory__c");
		territory.Name = $territory_xls[$i][0];
		territory.SVMXC__Active__c = $territory_xls[$i][1];
		territory.SVMXC__Average_Speed__c = $territory_xls[$i][2];
		territory.SVMXC__Max_Distance__c = $territory_xls[$i][3];
		territory.SVMXC__Fixed_Cost__c = $territory_xls[$i][4];
		territory.SVMXC__Per_Hour_Cost__c = $territory_xls[$i][5];
		territory.SVMXC__Per_Mile_Cost__c = $territory_xls[$i][6];
		//territory.SVMXC__Territory_s_Business_Hours__c = $BH_creation;
		Territories.push(territory);
	}
	var territory_result = _call(sforce.connection.create(Territories));
	_log("territory_result = "+territory_result);
	if(territory_result[0].id != null){
		_log("territory_result[0].id = "+territory_result[0].id);
		return territory_result[0].id;
	}
	return false;
}

function createTeam($team_xls){
	var createTeam = [];
	for(var $i=0;$i<$team_xls.length;$i++)
	{
		var team = new sforce.SObject("SVMXC__Service_Group__c");
		team.Name = $team_xls[$i][0];
		team.SVMXC__Active__c = $team_xls[$i][1];
		createTeam.push(team);
	}
	var team_result = _call(sforce.connection.create(createTeam));
	if(team_result[0].id != null){
		return team_result[0].id;
	}
	return false;
}

function createTech($territory_creation,$BH_creation,$createTeam_creation,$tech_xls){
	var createTech = [];
	var techId = [];
	var $isSuccess = false;
	_log("$tech_xls. length = "+$tech_xls.length);
	for(var $i=0;$i<$tech_xls.length;$i++)
	{
		var tech = new sforce.SObject("SVMXC__Service_Group_Members__c");
		tech.Name = $tech_xls[$i][0];
		tech.SVMXC__Active__c = $tech_xls[$i][1];
		tech.SVMXC__Enable_Scheduling__c = $tech_xls[$i][2];
		tech.SVMXC__Street__c = $tech_xls[$i][3];
		tech.SVMXC__City__c = $tech_xls[$i][4];
		tech.SVMXC__State__c = $tech_xls[$i][5];
		tech.SVMXC__Zip__c = $tech_xls[$i][6];
		tech.SVMXC__Country__c = $tech_xls[$i][7];
		tech.SVMXC__Service_Group__c = $createTeam_creation;
		tech.SVMXC__Service_Territory__c = $territory_creation;
		tech.SVMXC__Working_Hours__c = $BH_creation;
		createTech.push(tech);
	}
	var $tech_result = _call(sforce.connection.create(createTech));
	_log("$tech_result length = "+$tech_result.length);
	if($tech_result != 0 && $tech_result != null){
		$isSuccess = true
		for(var $x=0;$x<$tech_result.length;$x++){
			if($tech_result[$x].id === null){
				$isSuccess = false;
				return $isSuccess;
			}
			techId.push($tech_result[$x].id);
			_log("techId.push = "+techId);
		}
		_log("techId = "+techId);
		return techId;
	}
	return $isSuccess;
}

function createSkills($skill_xls){
	var createSkills = [];
	var skillId = [];
	var $isSuccess = false;
	for(var $i=0;$i<$skill_xls.length;$i++)
	{
		var skill = new sforce.SObject("SVMXC__Skill__c");
		skill.Name = $skill_xls[$i][0];
		skill.SVMXC__Active__c = $skill_xls[$i][1];
		skill.SVMXC__Skill_Category__c = $skill_xls[$i][2];
		createSkills.push(skill);
	}
	var skill_result = _call(sforce.connection.create(createSkills));
	if(skill_result.length != null){
		$isSuccess = true;
		for(var $x=0;$x<skill_result.length;$x++){
			skillId.push(skill_result[$x].id);
			_log("skillId.push = "+skillId);
		}
		_log("skill ids ="+skillId);
		return skillId;
	}
	return $isSuccess;
}

function createExpertise($exp_xls){
	var createExp = [];
	var $isSuccess = false;
	var expId = [];
	for(var $i = 0;$i<$exp_xls.length;$i++){
		var expertise = new sforce.SObject("SVMXC__Service_Group_Skills__c");
		expertise.SVMXC__Skill_Level__c=$exp_xls[$i][0];
		expertise.SVMXC__Group_Member__c=$exp_xls[$i][1];
	    expertise.SVMXC__Service_Group__c=$exp_xls[$i][2];
		expertise.SVMXC__Skill__c=$exp_xls[$i][3];
		createExp.push(expertise);
		_log("createExp = "+createExp);
	}
	var exp_result = _call(sforce.connection.create(createExp));
	_log("exp_result ="+exp_result);
	if(exp_result.length != null){
		$isSuccess = true;
		for(var $x=0;$x<exp_result.length;$x++){
			expId.push(exp_result[$x].id);
			_log("expId.push = "+expId);
		}
		_log("expId ids ="+expId);
		return expId;
	}
	return $isSuccess;
}

function createPrfRes($rec_Pref_xls){
	var createPrfRes = [];
	var $isSuccess = false;
	var prfResId = [];
	for(var $i = 0;$i<$rec_Pref_xls.length;$i++){
		var prfRes = new sforce.SObject("SVMXC__Resource_Preference__c");
		prfRes.SVMXC__Company__c=$rec_Pref_xls[$i][0];
		prfRes.SVMXC__Group_Member__c=$rec_Pref_xls[$i][1];
		prfRes.SVMXC__Preference_Type__c=$rec_Pref_xls[$i][2];
		createPrfRes.push(prfRes);
	}
	var pfrRes_result = _call(sforce.connection.create(createPrfRes));
	_log("pfrRes_result = "+pfrRes_result);
	if(pfrRes_result.length != null){
		_log("pfrRes_result.length = "+pfrRes_result.length);
		$isSuccess = true;
		for(var $x=0;$x<pfrRes_result.length;$x++){
			prfResId.push(pfrRes_result[$x].id);
			_log("pfrRes.push = "+prfResId);
		}
		_log("pfrRes ids ="+prfResId);
		return prfResId;
	}
	return $isSuccess;
}
//</browser>