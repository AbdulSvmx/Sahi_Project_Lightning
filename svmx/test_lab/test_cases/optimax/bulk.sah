var $un = "govendhan@svmx-cct5.com.cct5full";

var $pwd = "maxpl0re";





_navigateTo("http://test.salesforce.com");

_setValue(_emailbox("username"), $un);

_setValue(_password("pw"), $pwd);

_click(_submit("Log In to Sandbox"));





var $queryFromFile = $excel.readFromCustomExcel("../optimax/op_excleData/CA500_auto.xlsx", "CA 500","","");
var $nArr;
//Calling the sforce API
_set($callback, _fetch(callBulk($un,$pwd,$queryFromFile)));

_log($callback);



_wait(3000);
//SLA_violation($un, $pwd);
_set($SLA, _fetch(SLA_violation($un, $pwd)));
_log($SLA);

//<browser>

function callBulk($un,$pwd,$queryFromFile){

sforce.connection.sessionId = null;

sforce.connection.debuggingHeader = null; // this, too is necessary!

sforce.connection.login($un,$pwd);
var no_Initiate_WO = 0;
var no_Pending_WO = 0;
/*
var CreateRecords=[];
for(var $i=0;$i<$queryFromFile.length;$i++)
      {
      var wo_list = new sforce.SObject("SVMXC__Service_Order__c");
      wo_list.SVMXC__Street__c = $queryFromFile[$i][0];
      wo_list.SVMXC__City__c = $queryFromFile[$i][1];
      wo_list.SVMXC__State__c = $queryFromFile[$i][2];
      wo_list.SVMXC__Zip__c = $queryFromFile[$i][3];
      wo_list.SVMXC__Country__c = $queryFromFile[$i][4];
      wo_list.SVMXC__Primary_Territory__c = $queryFromFile[$i][5];
      wo_list.SVMXC__SM_Scheduling_Options__c = $queryFromFile[$i][6];
      wo_list.SVMXC__Preferred_Start_Time__c = $queryFromFile[$i][7];
      wo_list.SVMXC__Preferred_End_Time__c = $queryFromFile[$i][8];
      wo_list.SVMXC__Apply_Business_Hours_For_OptiMax__c = $queryFromFile[$i][9];
      wo_list.SVMXC__Preferred_Business_Hours__c = $queryFromFile[$i][10];
      CreateRecords.push(wo_list);
      }
result = sforce.connection.create(CreateRecords);
_wait(60000);*/

$op_act_createRecord.createWo();
	var initiate_WO_List = sforce.connection.query("Select Id, SVMXC__OptiMax_Status__c, SVMXC__Dispatch_Process__c, SVMXC__Primary_Territory__c From SVMXC__Service_Order__c Where SVMXC__Primary_Territory__c = 'a2S18000000MP1u'");
	var initiate_WO_Arr = initiate_WO_List.getArray("records");
	
	_log(" length "+initiate_WO_Arr.length);
		for(var $s=0;$s<initiate_WO_Arr.length;$s++){
			var initiate_WO = initiate_WO_Arr[$s];
			var is_Iniated = initiate_WO.SVMXC__OptiMax_Status__c;
			_log("is_Iniated = "+is_Iniated);
			if(is_Iniated === 'OPT_INITIATED'){
				no_Initiate_WO = no_Initiate_WO +1;
			}
			else {
				no_Pending_WO = no_Pending_WO + 1;
			}
		}
		_log("No of Initiated WO = "+no_Initiate_WO+" , No of Pending or Tentetive WO = "+no_Pending_WO);
		
return result;
}

function SLA_violation($un, $pwd){
      
      var sla_violation = 0;
      
      var dispatched_WO_List = sforce.connection.query("Select Id, SVMXC__Work_Order_Scheduling_Status__c, SVMXC__Scheduled_Date_Time__c, SVMXC__Preferred_Start_Time__c, SVMXC__Preferred_End_Time__c, SVMXC__Dispatch_Process__c From SVMXC__Service_Order__c Where SVMXC__Work_Order_Scheduling_Status__c = 'Dispatched' AND SVMXC__Dispatch_Process__c = 'a1o18000000n6ty'");
      
      var dispatched_WO_arr = dispatched_WO_List.getArray("records");
      for(var $s=0;$s<dispatched_WO_arr.length;$s++){
            var dispatched_WO = dispatched_WO_arr[$s];
            var wo_SDT = dispatched_WO.SVMXC__Scheduled_Date_Time__c;
            var wo_PST = dispatched_WO.SVMXC__Preferred_Start_Time__c;
            var wo_PET = dispatched_WO.SVMXC__Preferred_End_Time__c;
            
            if(wo_SDT > wo_PET){
                  sla_violation = sla_violation + 1;
            }
      }
      return "Number of SLA Violation = "+sla_violation+", out of = "+dispatched_WO_arr.length+" Work Orders";
}

function sForceApiCallLocal($queryComplex) {
                  return sforce.apex.executeAnonymous($queryComplex);
            }; 
 //<browser> 

            
      


